<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="generator" content="ReSpec 26.9.4">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>pre.idl{padding:1em;position:relative}
pre.idl>code{color:#000}
@media print{
pre.idl{white-space:pre-wrap}
}
.idlHeader{display:block;width:150px;background:#8ccbf2;color:#fff;font-family:sans-serif;font-weight:700;margin:-1em 0 1em -1em;height:28px;line-height:28px}
.idlHeader a.self-link{margin-left:.3cm;text-decoration:none;border-bottom:none}
.idlID{font-weight:700;color:#005a9c}
.idlType{color:#005a9c}
.idlName{color:#ff4500}
.idlName a{color:#ff4500;border-bottom:1px dotted #ff4500;text-decoration:none}
a.idlEnumItem{color:#000;border-bottom:1px dotted #ccc;text-decoration:none}
.idlSuperclass{font-style:italic;color:#005a9c}
.idlDefaultValue,.idlParamName{font-style:italic}
.extAttr{color:#666}
.idlSectionComment{color:gray}
.idlIncludes a{font-weight:700}
.respec-button-copy-paste:focus{text-decoration:none;border-color:#51a7e8;outline:0;box-shadow:0 0 5px rgba(81,167,232,.5)}
.respec-button-copy-paste.selected:focus,.respec-button-copy-paste:focus:hover{border-color:#51a7e8}
.respec-button-copy-paste.zeroclipboard-is-active,.respec-button-copy-paste.zeroclipboard-is-hover,.respec-button-copy-paste:active,.respec-button-copy-paste:hover{text-decoration:none;background-color:#ddd;background-image:linear-gradient(#eee,#ddd);border-color:#ccc}
.respec-button-copy-paste.selected,.respec-button-copy-paste.zeroclipboard-is-active,.respec-button-copy-paste:active{background-color:#dcdcdc;background-image:none;border-color:#b5b5b5;box-shadow:inset 0 2px 4px rgba(0,0,0,.15)}
.respec-button-copy-paste.selected:hover{background-color:#cfcfcf}
.respec-button-copy-paste.disabled,.respec-button-copy-paste.disabled:hover,.respec-button-copy-paste:disabled,.respec-button-copy-paste:disabled:hover{color:rgba(102,102,102,.5);cursor:default;background-color:rgba(229,229,229,.5);background-image:none;border-color:rgba(197,197,197,.5);box-shadow:none}
@media print{
.respec-button-copy-paste{visibility:hidden}
}</style>
<style>dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font:small Helvetica Neue,sans-serif,Droid Sans Fallback;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}</style>
  
  
<title>MediaStreamTrack Content Hints</title>
  
<style id="respec-mainstyle">@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
.hljs{background:0 0!important}
a abbr,h1 abbr,h2 abbr,h3 abbr,h4 abbr,h5 abbr,h6 abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
code{color:#c63501}
th code{color:inherit}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
a[href].self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
h2,h3,h4,h5,h6{position:relative}
aside.example .marker>a.self-link{color:inherit}
h2>a.self-link,h3>a.self-link,h4>a.self-link,h5>a.self-link,h6>a.self-link{border:none;color:inherit;font-size:83%;height:2em;left:-1.6em;opacity:.5;position:absolute;text-align:center;text-decoration:none;top:0;transition:opacity .2s;width:2em}
h2>a.self-link::before,h3>a.self-link::before,h4>a.self-link::before,h5>a.self-link::before,h6>a.self-link::before{content:"§";display:block}
@media (max-width:767px){
dd{margin-left:0}
h2>a.self-link,h3>a.self-link,h4>a.self-link,h5>a.self-link,h6>a.self-link{left:auto;top:auto}
}
@media print{
.removeOnSave{display:none}
}</style>
  

<meta name="description" content="This specification extends MediaStreamTrack to provide an
      optional hint about the user's preference on how the media should
      be treated when insufficient resources for perfect reproduction
      are available.">
<link rel="canonical" href="www.w3.org/TR/mst-content-hint/">
<style>var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}</style>
<script id="initialUserConfig" type="application/json">{
  "github": "https://https://tawasl-zahra.github.io/whimsywondershttps://https://tawasl-zahra.github.io/whimsywonderstawasl-zahra.github.io/whimsywondersgithub.com/w3c/mst-content-hint",
  "editors": [
    {
      "name": "Harald Alvestrand",
      "company": "Google",
      "w3cid": "24610"
    }
  ],
  "formerEditors": [
    {
      "name": "Peter Boström",
      "company": "Google"
    }
  ],
  "shortName": "mst-content-hint",
  "edDraftURI": "https://https://tawasl-zahra.github.io/whimsywondershttps://https://tawasl-zahra.github.io/whimsywonderstawasl-zahra.github.io/whimsywondersw3c.github.io/mst-content-hint/",
  "subjectPrefix": "[mst-content-hint]",
  "xref": [
    "mediacapture-streams"
  ],
  "group": "webrtc",
  "wgPublicList": "public-media-capture",
  "specStatus": "WD",
  "testSuiteURI": "https://https://tawasl-zahra.github.io/whimsywondershttps://https://tawasl-zahra.github.io/whimsywonderstawasl-zahra.github.io/whimsywondersgithub.com/web-platform-tests/wpt/tree/master/webrtc/",
  "publishDate": "2021-07-22",
  "previousMaturity": "WD",
  "previousPublishDate": "2021-07-01",
  "publishISODate": "2021-07-22T00:00:00.000Z",
  "generatedSubtitle": "Working Draft 22 July 2021"
}</script>
<link rel="stylesheet" href="www.w3.org/StyleSheets/TR/2016/W3C-WD">
</head>

<body class="h-entry" data-cite="WebIDL mediacapture-streams">
<div class="head">
    <a class="logo" href="www.w3.org/"><img crossorigin="" alt="W3C" height="48" src="www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72">
  </a> <h1 id="title" class="title">MediaStreamTrack Content Hints</h1>
    
    <h2>
      W3C Working Draft
      <time class="dt-published" datetime="2021-07-22">22 July 2021</time>
    </h2>
    <dl>
      <dt>This version:</dt>
<dd>
              <a class="u-url" href="www.w3.org/TR/2021/WD-mst-content-hint-20210722/">https://www.w3.org/TR/2021/WD-mst-content-hint-20210722/</a>
            </dd>
<dt>Latest published version:</dt>
<dd>
              <a href="www.w3.org/TR/mst-content-hint/">https://www.w3.org/TR/mst-content-hint/</a>
            </dd>
      <dt>Latest editor's draft:</dt>
<dd><a href="w3c.github.io/mst-content-hint/">https://w3c.github.io/mst-content-hint/</a></dd>
      <dt>Test suite:</dt>
<dd><a href="github.com/web-platform-tests/wpt/tree/master/webrtc/">https://github.com/web-platform-tests/wpt/tree/master/webrtc/</a></dd>
      
      
      <dt>Previous version:</dt>
<dd><a href="www.w3.org/TR/2021/WD-mst-content-hint-20210701/">https://www.w3.org/TR/2021/WD-mst-content-hint-20210701/</a></dd>
      
      <dt>Editor:</dt>
      <dd class="editor p-author h-card vcard" data-editor-id="24610">
    <span class="p-name fn">Harald Alvestrand</span> (<span class="p-org org h-org">Google</span>)
  </dd>
      <dt>
              Former editor:
            </dt>
<dd class="editor p-author h-card vcard">
    <span class="p-name fn">Peter Boström</span> (<span class="p-org org h-org">Google</span>)
  </dd>
      
      <dt>Participate:</dt>
<dd>
    <a href="github.com/w3c/mst-content-hint/">GitHub w3c/mst-content-hint</a>
  </dd>
<dd>
    <a href="github.com/w3c/mst-content-hint/issues/">File an issue</a>
  </dd>
<dd>
    <a href="github.com/w3c/mst-content-hint/commits/gh-pages">Commit history</a>
  </dd>
<dd>
    <a href="github.com/w3c/mst-content-hint/pulls/">Pull requests</a>
  </dd>
    </dl>
    
    
    
    <p class="copyright">
    <a href="www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    ©
    2021
    
    <a href="www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
    <a href="www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="www.keio.ac.jp/">Keio</a>,
    <a href="ev.buaa.edu.cn/">Beihang</a>). 
    W3C <a href="www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a href="www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a rel="license" href="www.w3.org/Consortium/Legal/2015/copyright-software-and-document">permissive document license</a> rules
    apply.
  </p>
    <hr title="Separator for header">
  </div>
  <section id="abstract" class="introductory"><h2>Abstract</h2>
    <p>
      This specification extends <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> to provide an
      optional hint about the user's preference on how the media should
      be treated when insufficient resources for perfect reproduction
      are available.
    </p>
    <p>
      This optional hint permits
      <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> sinks such as <dfn id="dfn-rtcpeerconnection" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">RTCPeerConnection</dfn>
      (defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-webrtc" title="WebRTC 1.0: Real-Time Communication Between Browsers">webrtc</a></cite>]) or <dfn id="dfn-mediarecorder" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">MediaRecorder</dfn> (defined in
      [<cite><a class="bibref" data-link-type="biblio" href="#bib-mediastream-recording" title="MediaStream Recording">mediastream-recording</a></cite>]) that process a track's audio or video
      content to choose processing parameters that are appropriate to the
      user's preferences.
    </p>
  </section>
  <section id="sotd" class="introductory"><h2>Status of This Document</h2>
<p><em>This section describes the status of this
      document at the time of its publication. Other documents may supersede
      this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision
      of this technical report can be found in the
      <a href="www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at
      https://www.w3.org/TR/.</em></p>
  <p>
    This document was published by the <a href="www.w3.org/groups/wg/webrtc">Web Real-Time Communications Working Group</a> as a
    Working Draft. 
    This document is intended to become a <abbr title="World Wide Web Consortium">W3C</abbr> Recommendation.
  </p>
<p>
    <a href="github.com/w3c/mst-content-hint/issues/">GitHub Issues</a> are preferred for
          discussion of this specification.
        
    Alternatively, you can send comments to our mailing list.
          Please send them to
          <a href="mailto:public-media-capture@w3.org?subject=%5Bmst-content-hint%5D">public-media-capture@w3.org</a>
          (<a href="mailto:public-media-capture-request@w3.org?subject=subscribe">subscribe</a>,
          <a href="lists.w3.org/Archives/Public/public-media-capture/">archives</a>) with <code>[mst-content-hint]</code> at the start of your
                email's subject.
        
  </p>
<p>
      Publication as a Working Draft does not imply endorsement
      by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership. 
    </p>
<p>This is a draft document and may be updated, replaced
  or obsoleted by other documents at any time. It is inappropriate to cite this
  document as other than work in progress.
  </p>
<p></p>
<p>
    
        This document was produced by a group
        operating under the
        <a href="www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent
          Policy</a>.
       
    
                <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
                <a rel="disclosure" href="www.w3.org/groups/wg/webrtc/ipr">public list of any patent disclosures</a>
          made in connection with the deliverables of
          the group; that page also includes
          instructions for disclosing a patent. An individual who has actual
          knowledge of a patent which the individual believes contains
          <a href="www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a>
          must disclose the information in accordance with
          <a href="www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
        
    
  </p>
<p>
                  This document is governed by the
                  <a id="w3c_process_revision" href="www.w3.org/2020/Process-20200915/">15 September 2020 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2>
<ol class="toc">
<li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li>
<li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li>
<li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a></li>
<li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">2. </bdi>Conformance</a></li>
<li class="tocline"><a class="tocxref" href="#terminology"><bdi class="secno">3. </bdi>Terminology</a></li>
<li class="tocline">
<a class="tocxref" href="#mediastreamtrack-extension"><bdi class="secno">4. </bdi>Extension to MediaStreamTrack</a><ol class="toc">
<li class="tocline"><a class="tocxref" href="#audio-content-hints"><bdi class="secno">4.1 </bdi>Audio Content Hints</a></li>
<li class="tocline"><a class="tocxref" href="#video-content-hints"><bdi class="secno">4.2 </bdi>Video Content Hints</a></li>
</ol>
</li>
<li class="tocline">
<a class="tocxref" href="#behaviors-of-other-components-based-on-content-hint"><bdi class="secno">5. </bdi>Behaviors of other components based on content-hint</a><ol class="toc">
<li class="tocline"><a class="tocxref" href="#behavior-of-a-mediastreamtrack"><bdi class="secno">5.1 </bdi>Behavior of a MediaStreamTrack</a></li>
<li class="tocline">
<a class="tocxref" href="#degradation-preference-when-encoding"><bdi class="secno">5.2 </bdi>Degradation preference when encoding</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#dictionary-rtcrtpsendparameters-new-members"><bdi class="secno">5.2.1 </bdi>Dictionary <span data-xref-type="_IDL_" data-link-type="idl" data-lt="RTCRtpSendParameters" data-cite="!WEBRTC#dom-rtcrtpsendparameters" class="formerLink"><code>RTCRtpSendParameters</code></span> New Members</a></li></ol>
</li>
<li class="tocline"><a class="tocxref" href="#behavior-of-an-rtcpeerconnection"><bdi class="secno">5.3 </bdi>Behavior of an RTCPeerConnection</a></li>
<li class="tocline"><a class="tocxref" href="#behavior-of-a-mediastreamrecorder"><bdi class="secno">5.4 </bdi>Behavior of a MediaStreamRecorder</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href="#security-and-privacy-considerations"><bdi class="secno">6. </bdi>Security and Privacy Considerations</a></li>
<li class="tocline">
<a class="tocxref" href="#references"><bdi class="secno">A. </bdi>References</a><ol class="toc">
<li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">A.1 </bdi>Normative references</a></li>
<li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">A.2 </bdi>Informative references</a></li>
</ol>
</li>
</ol></nav>
  <section id="introduction">
    <h2 id="x1-introduction">
<bdi class="secno">1. </bdi>Introduction<a class="self-link" aria-label="§" href="#introduction"></a>
</h2>
    <p>
      Algorithms used for processing speech and music differ greatly.
      Echo-cancellation algorithms developed for speech-type content might not
      work well on music, and noise-suppression algorithms might remove drum
      snares or other "noisy" content. While this makes speech more intelligible
      it is less appropriate for music signals.
    </p>
    <p>
      For video, webcam content often require denoising and is often
      intelligible even when downscaled or with high quantization levels.
      Screencast content of presentations or webpages with a lot of text content
      is completely unintelligible if the quantization levels are too high or
      if the content is downscaled or otherwise blurry.
    </p>
    <p>
      Without automatic detection of media content, a <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>
      consumer can only make an educated guess. This guess may be based on
      assuming that screencast content, such as
      <code>chrome.desktopCapture</code>, contains text content and must use low
      quantization levels, and drop frames extensively to meet bitrate
      requirements. Another assumption is that regular USB video devices provide
      webcam video, and higher quantization levels and downscaling are
      acceptible.
    </p>
    <p>
      While usually appropriate this educated guess leads to sub-optimal
      settings when incorrect. This manifests as high framedropping when
      screencasting high-motion content such as a movie or streaming a video
      game and treating it as text. Treating highly-detailed content as regular
      webcam video on the other hand leads to too-blurry content when being
      either quantized or downscaled beyond readability to meet bitrate
      requirements. This mismatch may also happen when HDMI video-capture cards
      are seen as USB webcams but actually screencast webpage text.
    </p>
    <figure id="text-downscaling">
      <img src="www.w3.org/TR/mst-content-hint/lorem-ipsum.png" alt="Lost text intelligibility when downscaling." height="100" width="672">
      <figcaption>Figure <bdi class="figno">1</bdi> <span class="fig-title">
        While downscaling can be done to preserve motion in low-bitrate
        scenarios, this example illustrates lost text intelligibility when
        incorrectly applied to detailed content. Example shows 100%, 50% and 25%
        cubic downscale corresponding to downscaling from HD to VGA and QVGA
        resolutions respectively.
      </span></figcaption>
    </figure>
    <p>
      In some cases the web application can make a more-educated guess or take
      user input to inform consumers of what kind of content is being encoded. A
      web application that streams video-game content would be able to preserve
      motion from desktop capture at the cost of individual frame detail. A
      music-studio application would be able to prevent noise suppression from
      removing snares from a music track.
    </p>
    <p>
      These settings are not intended to replace encoder-level settings
      completely but rather complement them with a simpler hint that does not
      require broad knowledge of video encoders, audio-processing steps or
      more extensive tuning.
    </p>
    <p>
      A separate section of this specification describes expected behavior
      for specific components that process a MediaStreamTrack.
    </p>
  </section>
  <section id="conformance"><h2 id="x2-conformance">
<bdi class="secno">2. </bdi>Conformance<a class="self-link" aria-label="§" href="#conformance"></a>
</h2>
<p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p>
<p>
        The key word <em class="rfc2119">MUST</em> in this document
        is to be interpreted as described in
        <a href="datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p>
  </section>
  <section id="terminology">
    <h2 id="x3-terminology">
<bdi class="secno">3. </bdi>Terminology<a class="self-link" aria-label="§" href="#terminology"></a>
</h2>
    <p> The terms <dfn id="dfn-rtcrtpsender" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="www.w3.org/TR/webrtc/#dom-rtcrtpsender">RTCRtpSender</a></dfn>
      and <dfn id="dom-rtcrtpsendparameters" data-idl="dictionary" data-title="RTCRtpSendParameters" data-dfn-for="" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="www.w3.org/TR/webrtc/#dom-rtcrtpsendparameters"><code>RTCRtpSendParameters</code></a></dfn>
      are defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-webrtc" title="WebRTC 1.0: Real-Time Communication Between Browsers">WEBRTC</a></cite>].
    </p>
  </section>
  <section data-link-for="MediaStreamTrack" id="mediastreamtrack-extension">
    <h2 id="x4-extension-to-mediastreamtrack">
<bdi class="secno">4. </bdi>Extension to MediaStreamTrack<a class="self-link" aria-label="§" href="#mediastreamtrack-extension"></a>
</h2>
    <pre class="idl def" id="webidl-1236799622"><span class="idlHeader"><a class="self-link" href="#webidl-1236799622">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-mediastreamtrack-partial-1" data-title="MediaStreamTrack">partial interface <a data-idl="partial" data-link-type="interface" data-title="MediaStreamTrack" class="idlID" data-dfn-for="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack">MediaStreamTrack</a> {<span data-idl="" class="idlAttribute" id="idl-def-mediastreamtrack-contenthint" data-title="contentHint" data-dfn-for="MediaStreamTrack">
  attribute<span class="idlType"> <a data-type="interface" href="heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-mediastreamtrack-contenthint" id="ref-for-dom-mediastreamtrack-contenthint-1"><code>contentHint</code></a>;</span>
};</span></code></pre>
    <p>
      This specification extends <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> and makes use of
      its <a data-link-type="idl" data-type="attribute" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-kind"><code>kind</code></a> attribute as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-getusermedia" title="Media Capture and Streams">GETUSERMEDIA</a></cite>].
    </p>
    <p>
      Each <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> has an associated <dfn id="dfn-application-set-content-hint" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">application-set
      content hint</dfn>, which is initially <code>""</code>, signifying unset.
      This <a href="#dfn-application-set-content-hint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-application-set-content-hint-1">application-set content hint</a> corresponds to the
      <dfn data-dfn-for="MediaStreamTrack" data-export="" data-dfn-type="attribute" id="dom-mediastreamtrack-contenthint" data-idl="attribute" data-title="contentHint" data-type="DOMString" data-lt="contentHint" data-local-lt="MediaStreamTrack.contentHint" tabindex="0" aria-haspopup="dialog"><code>contentHint</code></dfn> attribute of <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> which may be
      used by the web application to provide a hint of what type of content is
      contained within the track, to guide how it should be treated by
      <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> consumers.
    </p>
    <p>
      Valid values for the application-set content hint are dependent on the
      <a data-link-type="idl" data-type="attribute" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-kind"><code>kind</code></a> of <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> contained. On setting
      <a href="#dom-mediastreamtrack-contenthint" class="internalDFN" data-link-type="idl" id="ref-for-dom-mediastreamtrack-contenthint-2"><code>contentHint</code></a> to <i>value</i>,
    </p>
    <ol>
      <li>
        If this <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>'s <a data-link-type="idl" data-type="attribute" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-kind"><code>kind</code></a> attribute is
        <code>"audio"</code>, and <i>value</i> is not one of <code>""</code>,
        <code>"speech"</code>, <code>"speech-recognition"</code>, or <code>"music"</code>, abort these steps.
      </li>
      <li>
        If this <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>'s <a data-link-type="idl" data-type="attribute" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-kind"><code>kind</code></a> attribute is
        <code>"video"</code>, and <i>value</i> is not one of <code>""</code>,
        <a href="#idl-def-VideoContentHint.motion" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-VideoContentHint.motion-1"><code>"motion"</code></a>, <a href="#idl-def-VideoContentHint.detail" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-VideoContentHint.detail-1"><code>"detail"</code></a> or <a href="#idl-def-VideoContentHint.text" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-VideoContentHint.text-1"><code>"text"</code></a>,
        abort these steps.
      </li>
      <li>
        Set this <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>'s application-set content hint to
        <i>value</i>.
      </li>
      <li>
        The implementation should adapt its decision on how to handle the
        content of this <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> according to the new value of
        its application-set content hint. This adaptation should happen as
        quickly as reasonable, e.g. within the next couple of captured video
        frames or audio buffers.
      </li>
    </ol>
    <p>
      On getting <a data-link-type="idl" href="#dom-mediastreamtrack-contenthint" class="internalDFN" id="ref-for-dom-mediastreamtrack-contenthint-3"><code>contentHint</code></a>,
    </p>
    <ol>
      <li>
        Return this <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>'s <a data-link-type="dfn" href="#dfn-application-set-content-hint" class="internalDFN" id="ref-for-dfn-application-set-content-hint-2">application-set content hint</a>.
      </li>
    </ol>
    <p>
      <i>Note that the initial value of application-set content hints is
        <code>""</code>, corresponding to that no hint has been provided. It
      does not default to the implementation's best guess of contained type of
      content.</i>
    </p>
    <section id="audio-content-hints">
      <h3 id="x4-1-audio-content-hints">
<bdi class="secno">4.1 </bdi>Audio Content Hints<a class="self-link" aria-label="§" href="#audio-content-hints"></a>
</h3>
      <p>
        Audio content hints are only applicable when the <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>
        contains an audio track.
      </p>
      <table class="simple"><tbody>
<tr><th colspan="2">Audio content hints</th></tr>
        <tr>
<td><code>""</code></td>
<td><p>
          No hint has been provided, the implementation should make its
          best-informed guess on how to handle contained audio data. This may be
          inferred from how the track was opened or by doing content analysis.
        </p></td>
</tr>
<tr>
<td><dfn id="idl-def-AudioContentHint.speech" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><code>"speech"</code></dfn></td>
<td><p>
          The track should be treated as if it contains speech data. Consuming
          this signal it may be appropriate to apply noise suppression or boost
          intelligibility of the incoming signal.
        </p></td>
</tr>
        <tr>
<td><dfn id="idl-def-AudioContentHint.speech-recognition" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><code>"speech-recognition"</code></dfn></td>
<td><p>
          The track should be treated as if it contains data for the purpose of
          speech recognition by a machine. Consuming this signal it may be
          appropriate to boost intelligibility of the incoming signal for
          transcription and turn off audio-processing components that are used for
          human consumption.
        </p></td>
</tr>
        <tr>
<td><dfn id="idl-def-AudioContentHint.music" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><code>"music"</code></dfn></td>
<td><p>
          The track should be treated as if it contains music data. Generally this
          might imply tuning or turning off audio-processing components that are
          used to process speech data to prevent the audio from being distorted.
        </p></td>
</tr>
      </tbody></table>
    </section>
    <section id="video-content-hints">
      <h3 id="x4-2-video-content-hints">
<bdi class="secno">4.2 </bdi>Video Content Hints<a class="self-link" aria-label="§" href="#video-content-hints"></a>
</h3>
      <p>
        Video content hints are only applicable when the <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>
        contains a video track.
      </p>
      <table class="simple"><tbody>
<tr><th colspan="2">Video content hints</th></tr>
        <tr>
<td><code>""</code></td>
<td><p>
          No hint has been provided, the implementation should make its
          best-informed guess on how contained video content should be treated.
          This can for example be inferred from how the track was opened or by
          doing content analysis.
        </p></td>
</tr>
<tr>
<td><dfn id="idl-def-VideoContentHint.motion" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><code>"motion"</code></dfn></td>
<td><p>
          The track should be treated as if it contains video where motion is
          important. This is normally webcam video, movies or video games.
          Quantization artefacts and downscaling are acceptible in order to
          preserve motion as well as possible while still retaining target
          bitrates. During low bitrates when compromises have to be made, more
          effort is spent on preserving frame rate than edge quality and details.
        </p></td>
</tr>
        <tr>
<td><dfn id="idl-def-VideoContentHint.detail" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><code>"detail"</code></dfn></td>
<td><p>
          The track should be treated as if video details are extra important.
          This is generally applicable to presentations or web pages with text
          content, painting or line art. This setting would normally optimize for
          detail in the resulting individual frames rather than smooth playback.
          Artefacts from quantization or downscaling that make small text or line
          art unintelligible should be avoided.
        </p></td>
</tr>
        <tr>
<td><dfn id="idl-def-VideoContentHint.text" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><code>"text"</code></dfn></td>
<td><p>
          The track should be treated as if video details are extra important,
          and that significant sharp edges and areas of consistent color can
          occur frequently.
          This is generally applicable to presentations or web pages with text
          content. This setting would normally optimize for
          detail in the resulting individual frames rather than smooth
          playback, and may take advantage of encoder tools that optimize for
          text rendering.
          Artefacts from quantization or downscaling that make small text
          or line art unintelligible should be avoided.
        </p></td>
</tr>
      </tbody></table>
    </section>
  </section>
  <section id="behaviors-of-other-components-based-on-content-hint">
    <h2 id="x5-behaviors-of-other-components-based-on-content-hint">
<bdi class="secno">5. </bdi>Behaviors of other components based on content-hint<a class="self-link" aria-label="§" href="#behaviors-of-other-components-based-on-content-hint"></a>
</h2>
    <section id="behavior-of-a-mediastreamtrack">
      <h3 id="x5-1-behavior-of-a-mediastreamtrack">
<bdi class="secno">5.1 </bdi>Behavior of a MediaStreamTrack<a class="self-link" aria-label="§" href="#behavior-of-a-mediastreamtrack"></a>
</h3>
      <p>When setting a <a data-link-type="idl" href="#dom-mediastreamtrack-contenthint" class="internalDFN" id="ref-for-dom-mediastreamtrack-contenthint-4"><code>contentHint</code></a> value for a <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>, the
        UA <em class="rfc2119">MUST</em> <a href="#dfn-apply-a-default" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-apply-a-default-1">apply a default</a> as follows:
      </p>
      <ul>
        <li>For an audio track with the value <a href="#idl-def-AudioContentHint.music" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-AudioContentHint.music-1"><code>"music"</code></a>, and for constraints
          echoCancellation, autoGainControl and noiseSuppression
          apply a default of "false".</li>
        <li>For an audio track with the value <a href="#idl-def-AudioContentHint.speech" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-AudioContentHint.speech-1"><code>"speech"</code></a>, and for constraints
          echoCancellation and autoGainControl, apply a default of
          "true".</li>
        <li>For an audio track with the value <a href="#idl-def-AudioContentHint.speech-recognition" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-AudioContentHint.speech-recognition-1"><code>"speech-recognition"</code></a>, and for
          constraints echoCancellation, autoGainControl, and noiseSuppression,
          apply a default of "false".</li>
      </ul>
      <p>To <dfn id="dfn-apply-a-default" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">apply a default</dfn> to the constraint <var>c</var>
        with value <var>t</var>, perform the following steps:
        </p>
<ul>
          <li>If the value <var>t</var> satisfies the applied constraints,
            set the setting corresponding to c <var>t</var>.</li>
          <li>Otherwise, choose a value for the setting corresponding to c
            that satisfies the applied constraints.</li>
          <li>Remember the value <var>t</var>.</li>
          <li>In parallel, update the track with the new settings.</li>
        </ul>
      <p>Whenever the "apply constraints" algorithm is subsequently
        run, the UA <em class="rfc2119">MUST</em> choose the remembered value <var>t</var> if it is
        now a permitted value.
      </p>
      <p>When setting a <a data-link-type="idl" href="#dom-mediastreamtrack-contenthint" class="internalDFN" id="ref-for-dom-mediastreamtrack-contenthint-5"><code>contentHint</code></a> value of <code>""</code>, all remembered values of
        <var>t</var> are removed.
      </p>
    </section>
    <section id="degradation-preference-when-encoding">
      <h3 id="x5-2-degradation-preference-when-encoding">
<bdi class="secno">5.2 </bdi>Degradation preference when encoding<a class="self-link" aria-label="§" href="#degradation-preference-when-encoding"></a>
</h3>
      <p>
        When encoding video, and some constraint (bandwidth, CPU) prevents
        encoding at the configured framerate and resolution, the encoder
        must make a choice on how to modify the encoding parameters.
      </p>
      <p>
        This section defines terms to describe the choice, and an enum
        that can be used to indicate that choice in an API.
      </p>
      <div>
        <pre class="idl def" id="webidl-796591925"><span class="idlHeader"><a class="self-link" href="#webidl-796591925">WebIDL</a></span><code><span data-idl="" class="idlEnum" id="idl-def-rtcdegradationpreference" data-title="RTCDegradationPreference">enum <dfn data-export="" data-dfn-type="enum" id="dom-rtcdegradationpreference" data-idl="enum" data-title="RTCDegradationPreference" data-dfn-for="RTCDegradationPreference" class="idlID" tabindex="0" aria-haspopup="dialog"><code>RTCDegradationPreference</code></dfn> {
  <span class="idlEnumItem">"<a class="internalDFN" data-link-type="enum-value" href="#dom-rtcdegradationpreference-maintain-framerate" id="ref-for-dom-rtcdegradationpreference-maintain-framerate-1"><code>maintain-framerate</code></a>"</span>,
  <span class="idlEnumItem">"<a class="internalDFN" data-link-type="enum-value" href="#dom-rtcdegradationpreference-maintain-resolution" id="ref-for-dom-rtcdegradationpreference-maintain-resolution-1"><code>maintain-resolution</code></a>"</span>,
  <span class="idlEnumItem">"<a class="internalDFN" data-link-type="enum-value" href="#dom-rtcdegradationpreference-balanced" id="ref-for-dom-rtcdegradationpreference-balanced-1"><code>balanced</code></a>"</span>
};</span></code></pre>
        <table data-link-for="RTCDegradationPreference" data-dfn-for="RTCDegradationPreference" class="simple">
          <tbody>
            <tr>
              <th colspan="2">
<a data-link-type="idl" data-lt="RTCDegradationPreference" href="#dom-rtcdegradationpreference" class="internalDFN" id="ref-for-dom-rtcdegradationpreference-1"><code>RTCDegradationPreference</code></a> Enumeration description</th>
            </tr>
            <tr>
              <td data-tests="RTCRtpParameters-degradationPreference.html"><dfn data-idl="enum-value" data-export="" data-dfn-type="enum-value" id="dom-rtcdegradationpreference-maintain-framerate" data-title="maintain-framerate" data-dfn-for="RTCDegradationPreference" tabindex="0" aria-haspopup="dialog"><code>maintain-framerate</code></dfn></td>
              <td>
                <p>Degrade resolution in order to maintain framerate.</p>
              </td>
            </tr>
            <tr>
              <td><dfn data-idl="enum-value" data-export="" data-dfn-type="enum-value" id="dom-rtcdegradationpreference-maintain-resolution" data-title="maintain-resolution" data-dfn-for="RTCDegradationPreference" tabindex="0" aria-haspopup="dialog"><code>maintain-resolution</code></dfn></td>
              <td>
                <p>Degrade framerate in order to maintain resolution.</p>
              </td>
            </tr>
            <tr>
              <td data-tests="RTCRtpParameters-degradationPreference.html"><dfn data-idl="enum-value" data-export="" data-dfn-type="enum-value" id="dom-rtcdegradationpreference-balanced" data-title="balanced" data-dfn-for="RTCDegradationPreference" tabindex="0" aria-haspopup="dialog"><code>balanced</code></dfn></td>
              <td>
                <p>Degrade a balance of framerate and resolution.</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      An attribute is defined for <a data-link-type="idl" data-lt="RTCRtpSendParameters" href="www.w3.org/TR/webrtc/#dom-rtcrtpsendparameters"><code>RTCRtpSendParameters</code></a> that allows this
      to be explicitly indicated for an <a data-link-type="idl" data-lt="RTCRtpSender" href="www.w3.org/TR/webrtc/#dom-rtcrtpsender"><code>RTCRtpSender</code></a>:

      <pre class="idl def" id="webidl-77522463"><span class="idlHeader"><a class="self-link" href="#webidl-77522463">WebIDL</a></span><code><span data-idl="" class="idlDictionary" id="idl-def-rtcrtpsendparameters-partial-1" data-title="RTCRtpSendParameters">partial dictionary <a class="internalDFN idlID" data-link-type="dictionary" href="#dom-rtcrtpsendparameters"><code>RTCRtpSendParameters</code></a> {<span data-idl="" class="idlMember" id="idl-def-rtcrtpsendparameters-degradationpreference" data-title="degradationPreference" data-dfn-for="RTCRtpSendParameters"><span class="idlType">
        <a href="#dom-rtcdegradationpreference" class="internalDFN" data-link-type="idl" id="ref-for-dom-rtcdegradationpreference-2"><code>RTCDegradationPreference</code></a></span> <dfn data-export="" data-dfn-type="dict-member" id="dom-rtcrtpsendparameters-degradationpreference" data-idl="field" data-title="degradationPreference" data-dfn-for="RTCRtpSendParameters" data-type="RTCDegradationPreference" class="idlName" tabindex="0" aria-haspopup="dialog"><code>degradationPreference</code></dfn>;</span>
       };</span></code></pre>
      <section id="dictionary-rtcrtpsendparameters-new-members">
        <h4 id="x5-2-1-dictionary-rtcrtpsendparameters-new-members">
<bdi class="secno">5.2.1 </bdi>Dictionary <a data-link-type="idl" data-lt="RTCRtpSendParameters" href="www.w3.org/TR/webrtc/#dom-rtcrtpsendparameters"><code>RTCRtpSendParameters</code></a> New Members<a class="self-link" aria-label="§" href="#dictionary-rtcrtpsendparameters-new-members"></a>
</h4>
        <dl>
          <dt data-tests="RTCRtpParameters-degradationPreference.html">
<dfn data-idl="" id="dfn-degradationpreference" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><code>degradationPreference</code></dfn> of type
            <a data-link-type="idl" data-lt="RTCDegradationPreference" href="#dom-rtcdegradationpreference" class="internalDFN" id="ref-for-dom-rtcdegradationpreference-3"><code>RTCDegradationPreference</code></a>.
          </dt>
<dd>
            <p>When bandwidth is constrained and the
              <a data-link-type="idl" data-lt="RTCRtpSender" href="www.w3.org/TR/webrtc/#dom-rtcrtpsender"><code>RTCRtpSender</code></a> needs to choose between degrading
              resolution or degrading framerate,
              <a data-link-type="idl" href="#dom-rtcrtpsendparameters-degradationpreference" class="internalDFN" id="ref-for-dom-rtcrtpsendparameters-degradationpreference-1"><code>degradationPreference</code></a> indicates which is
              preferred.</p>
          </dd>
        </dl>
      </section>
    </section>
    <section id="behavior-of-an-rtcpeerconnection">
      <h3 id="x5-3-behavior-of-an-rtcpeerconnection">
<bdi class="secno">5.3 </bdi>Behavior of an RTCPeerConnection<a class="self-link" aria-label="§" href="#behavior-of-an-rtcpeerconnection"></a>
</h3>
      <p>An <a data-link-type="idl" data-lt="RTCRtpSender" href="www.w3.org/TR/webrtc/#dom-rtcrtpsender"><code>RTCRtpSender</code></a> transmitting a <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> for which a
        <a data-link-type="idl" href="#dom-mediastreamtrack-contenthint" class="internalDFN" id="ref-for-dom-mediastreamtrack-contenthint-6"><code>contentHint</code></a> attribute has been
        set <em class="rfc2119">MUST</em> use the following degradation preferences, unless an
        explicit <a data-link-type="idl" href="#dom-rtcrtpsendparameters-degradationpreference" class="internalDFN" id="ref-for-dom-rtcrtpsendparameters-degradationpreference-2"><code>degradationPreference</code></a> attribute has been set in the sender's
        parameters:
      </p>
      <ul>
        <li>For a video track with the attribute value <a href="#idl-def-VideoContentHint.motion" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-VideoContentHint.motion-2"><code>"motion"</code></a>,
          use "<a data-link-type="idl" href="#dom-rtcdegradationpreference-maintain-framerate" class="internalDFN" id="ref-for-dom-rtcdegradationpreference-maintain-framerate-2"><code>maintain-framerate</code></a>".
        </li>
        <li>For a video track with the attribute value <a href="#idl-def-VideoContentHint.detail" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-VideoContentHint.detail-2"><code>"detail"</code></a>,
          use "<a data-link-type="idl" href="#dom-rtcdegradationpreference-maintain-resolution" class="internalDFN" id="ref-for-dom-rtcdegradationpreference-maintain-resolution-2"><code>maintain-resolution</code></a>".
        </li>
        <li>For a video track with the attribute value <a href="#idl-def-VideoContentHint.text" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-VideoContentHint.text-2"><code>"text"</code></a>,
          use "<a data-link-type="idl" href="#dom-rtcdegradationpreference-maintain-resolution" class="internalDFN" id="ref-for-dom-rtcdegradationpreference-maintain-resolution-3"><code>maintain-resolution</code></a>". In addition, if the
        encoding codec is AV1, activate encoding tools for "text" mode.
        </li>
      </ul>
    </section>
    <section id="behavior-of-a-mediastreamrecorder">
      <h3 id="x5-4-behavior-of-a-mediastreamrecorder">
<bdi class="secno">5.4 </bdi>Behavior of a MediaStreamRecorder<a class="self-link" aria-label="§" href="#behavior-of-a-mediastreamrecorder"></a>
</h3>
      <p>For a video track with the attribute value <a href="#idl-def-VideoContentHint.text" class="internalDFN" data-link-type="dfn" id="ref-for-idl-def-VideoContentHint.text-3"><code>"text"</code></a>, if the
        encoding codec is AV1, activate encoding tools for "text"
        mode.
      </p>
    </section>
  </section>
  <section id="security-and-privacy-considerations">
    <h2 id="x6-security-and-privacy-considerations">
<bdi class="secno">6. </bdi>Security and Privacy Considerations<a class="self-link" aria-label="§" href="#security-and-privacy-considerations"></a>
</h2>
    <p>
      This specification adds an API where the user can send
      information to the user agent. This information is not
      communicated elsewhere, and is not stored in any permanent
      location.
    </p>
    <p>
      By probing this API, the client may get some information on how
      the user agent implements this specification, which may give some
      insight into its configuration. Apart from this, no user agent
      information or data is exposed to the client through this API,
      and the API does not give any access to browser UI, influence
      over the user agent's security characteristics or the generation
      of temporary identifiers.
    </p>
    <p>
      This API does not distinguish between first-party, third-party
      or incognito contexts; it behaves identically in all these
      cases.
    </p>
    <p>
      No personally identifiable or otherwise sensitive information is
      handled via the use of this API.
    </p>
    
  </section>



<section id="references" class="appendix"><h2 id="a-references">
<bdi class="secno">A. </bdi>References<a class="self-link" aria-label="§" href="#references"></a>
</h2>
<section id="normative-references">
    <h3 id="a-1-normative-references">
<bdi class="secno">A.1 </bdi>Normative references<a class="self-link" aria-label="§" href="#normative-references"></a>
</h3>
    <dl class="bibliography">
<dt id="bib-getusermedia">[GETUSERMEDIA]</dt>
<dd>
<a href="www.w3.org/TR/mediacapture-streams/"><cite>Media Capture and Streams</cite></a>. Cullen Jennings; Bernard Aboba; Jan-Ivar Bruaroey; Henrik Boström; youenn fablet; Daniel Burnett; Adam Bergkvist; Anant Narayanan.  W3C. 15 July 2021. W3C Candidate Recommendation. URL: <a href="www.w3.org/TR/mediacapture-streams/">https://www.w3.org/TR/mediacapture-streams/</a>
</dd>
<dt id="bib-rfc2119">[RFC2119]</dt>
<dd>
<a href="www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
</dd>
<dt id="bib-rfc8174">[RFC8174]</dt>
<dd>
<a href="www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
</dd>
<dt id="bib-webidl">[webidl]</dt>
<dd>
<a href="heycam.github.io/webidl/"><cite>Web IDL</cite></a>. Boris Zbarsky.  W3C. 15 December 2016. W3C Editor's Draft. URL: <a href="heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
</dd>
<dt id="bib-webrtc">[WEBRTC]</dt>
<dd>
<a href="www.w3.org/TR/webrtc/"><cite>WebRTC 1.0: Real-Time Communication Between Browsers</cite></a>. Cullen Jennings; Henrik Boström; Jan-Ivar Bruaroey.  W3C. 26 January 2021. W3C Recommendation. URL: <a href="www.w3.org/TR/webrtc/">https://www.w3.org/TR/webrtc/</a>
</dd>
</dl>
  </section><section id="informative-references">
    <h3 id="a-2-informative-references">
<bdi class="secno">A.2 </bdi>Informative references<a class="self-link" aria-label="§" href="#informative-references"></a>
</h3>
    <dl class="bibliography">
<dt id="bib-mediastream-recording">[mediastream-recording]</dt>
<dd>
<a href="www.w3.org/TR/mediastream-recording/"><cite>MediaStream Recording</cite></a>. Miguel Casas-sanchez; James Barnett; Travis Leithead.  W3C. 4 June 2021. W3C Working Draft. URL: <a href="www.w3.org/TR/mediastream-recording/">https://www.w3.org/TR/mediastream-recording/</a>
</dd>
</dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-rtcpeerconnection" aria-label="Links in this document to definition: RTCPeerConnection">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-rtcpeerconnection" aria-label="Permalink for definition: RTCPeerConnection. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-mediarecorder" aria-label="Links in this document to definition: MediaRecorder">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-mediarecorder" aria-label="Permalink for definition: MediaRecorder. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-application-set-content-hint" aria-label="Links in this document to definition: application-set content hint">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-application-set-content-hint" aria-label="Permalink for definition: application-set content hint. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-application-set-content-hint-1" title="§ 4. Extension to MediaStreamTrack">§ 4. Extension to MediaStreamTrack</a> <a href="#ref-for-dfn-application-set-content-hint-2" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-mediastreamtrack-contenthint" aria-label="Links in this document to definition: contentHint">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-mediastreamtrack-contenthint" aria-label="Permalink for definition: contentHint. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-1236799622">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dom-mediastreamtrack-contenthint-1" title="§ 4. Extension to MediaStreamTrack">§ 4. Extension to MediaStreamTrack</a> <a href="#ref-for-dom-mediastreamtrack-contenthint-2" title="Reference 2">(2)</a> <a href="#ref-for-dom-mediastreamtrack-contenthint-3" title="Reference 3">(3)</a> 
  </li>
<li>
    <a href="#ref-for-dom-mediastreamtrack-contenthint-4" title="§ 5.1 Behavior of a MediaStreamTrack">§ 5.1 Behavior of a MediaStreamTrack</a> <a href="#ref-for-dom-mediastreamtrack-contenthint-5" title="Reference 2">(2)</a> 
  </li>
<li>
    <a href="#ref-for-dom-mediastreamtrack-contenthint-6" title="§ 5.3 Behavior of an RTCPeerConnection">§ 5.3 Behavior of an RTCPeerConnection</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-idl-def-AudioContentHint.speech" aria-label="Links in this document to definition: &quot;speech&quot;">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#idl-def-AudioContentHint.speech" aria-label="Permalink for definition: &quot;speech&quot;. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-idl-def-AudioContentHint.speech-1" title="§ 5.1 Behavior of a MediaStreamTrack">§ 5.1 Behavior of a MediaStreamTrack</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-idl-def-AudioContentHint.speech-recognition" aria-label="Links in this document to definition: &quot;speech-recognition&quot;">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#idl-def-AudioContentHint.speech-recognition" aria-label="Permalink for definition: &quot;speech-recognition&quot;. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-idl-def-AudioContentHint.speech-recognition-1" title="§ 5.1 Behavior of a MediaStreamTrack">§ 5.1 Behavior of a MediaStreamTrack</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-idl-def-AudioContentHint.music" aria-label="Links in this document to definition: &quot;music&quot;">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#idl-def-AudioContentHint.music" aria-label="Permalink for definition: &quot;music&quot;. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-idl-def-AudioContentHint.music-1" title="§ 5.1 Behavior of a MediaStreamTrack">§ 5.1 Behavior of a MediaStreamTrack</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-idl-def-VideoContentHint.motion" aria-label="Links in this document to definition: &quot;motion&quot;">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#idl-def-VideoContentHint.motion" aria-label="Permalink for definition: &quot;motion&quot;. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-idl-def-VideoContentHint.motion-1" title="§ 4. Extension to MediaStreamTrack">§ 4. Extension to MediaStreamTrack</a> 
  </li>
<li>
    <a href="#ref-for-idl-def-VideoContentHint.motion-2" title="§ 5.3 Behavior of an RTCPeerConnection">§ 5.3 Behavior of an RTCPeerConnection</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-idl-def-VideoContentHint.detail" aria-label="Links in this document to definition: &quot;detail&quot;">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#idl-def-VideoContentHint.detail" aria-label="Permalink for definition: &quot;detail&quot;. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-idl-def-VideoContentHint.detail-1" title="§ 4. Extension to MediaStreamTrack">§ 4. Extension to MediaStreamTrack</a> 
  </li>
<li>
    <a href="#ref-for-idl-def-VideoContentHint.detail-2" title="§ 5.3 Behavior of an RTCPeerConnection">§ 5.3 Behavior of an RTCPeerConnection</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-idl-def-VideoContentHint.text" aria-label="Links in this document to definition: &quot;text&quot;">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#idl-def-VideoContentHint.text" aria-label="Permalink for definition: &quot;text&quot;. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-idl-def-VideoContentHint.text-1" title="§ 4. Extension to MediaStreamTrack">§ 4. Extension to MediaStreamTrack</a> 
  </li>
<li>
    <a href="#ref-for-idl-def-VideoContentHint.text-2" title="§ 5.3 Behavior of an RTCPeerConnection">§ 5.3 Behavior of an RTCPeerConnection</a> 
  </li>
<li>
    <a href="#ref-for-idl-def-VideoContentHint.text-3" title="§ 5.4 Behavior of a MediaStreamRecorder">§ 5.4 Behavior of a MediaStreamRecorder</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-apply-a-default" aria-label="Links in this document to definition: apply a default">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-apply-a-default" aria-label="Permalink for definition: apply a default. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-apply-a-default-1" title="§ 5.1 Behavior of a MediaStreamTrack">§ 5.1 Behavior of a MediaStreamTrack</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-rtcdegradationpreference" aria-label="Links in this document to definition: RTCDegradationPreference">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-rtcdegradationpreference" aria-label="Permalink for definition: RTCDegradationPreference. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dom-rtcdegradationpreference-1" title="§ 5.2 Degradation preference when encoding">§ 5.2 Degradation preference when encoding</a> <a href="#ref-for-dom-rtcdegradationpreference-2" title="Reference 2">(2)</a> 
  </li>
<li>
    <a href="#ref-for-dom-rtcdegradationpreference-3" title="§ 5.2.1 Dictionary RTCRtpSendParameters New Members">§ 5.2.1 Dictionary RTCRtpSendParameters New Members</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-rtcdegradationpreference-maintain-framerate" aria-label="Links in this document to definition: maintain-framerate">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-rtcdegradationpreference-maintain-framerate" aria-label="Permalink for definition: maintain-framerate. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-796591925">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dom-rtcdegradationpreference-maintain-framerate-1" title="§ 5.2 Degradation preference when encoding">§ 5.2 Degradation preference when encoding</a> 
  </li>
<li>
    <a href="#ref-for-dom-rtcdegradationpreference-maintain-framerate-2" title="§ 5.3 Behavior of an RTCPeerConnection">§ 5.3 Behavior of an RTCPeerConnection</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-rtcdegradationpreference-maintain-resolution" aria-label="Links in this document to definition: maintain-resolution">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-rtcdegradationpreference-maintain-resolution" aria-label="Permalink for definition: maintain-resolution. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-796591925">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dom-rtcdegradationpreference-maintain-resolution-1" title="§ 5.2 Degradation preference when encoding">§ 5.2 Degradation preference when encoding</a> 
  </li>
<li>
    <a href="#ref-for-dom-rtcdegradationpreference-maintain-resolution-2" title="§ 5.3 Behavior of an RTCPeerConnection">§ 5.3 Behavior of an RTCPeerConnection</a> <a href="#ref-for-dom-rtcdegradationpreference-maintain-resolution-3" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-rtcdegradationpreference-balanced" aria-label="Links in this document to definition: balanced">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-rtcdegradationpreference-balanced" aria-label="Permalink for definition: balanced. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-796591925">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dom-rtcdegradationpreference-balanced-1" title="§ 5.2 Degradation preference when encoding">§ 5.2 Degradation preference when encoding</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-rtcrtpsendparameters-degradationpreference" aria-label="Links in this document to definition: degradationPreference">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-rtcrtpsendparameters-degradationpreference" aria-label="Permalink for definition: degradationPreference. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dom-rtcrtpsendparameters-degradationpreference-1" title="§ 5.2.1 Dictionary RTCRtpSendParameters New Members">§ 5.2.1 Dictionary RTCRtpSendParameters New Members</a> 
  </li>
<li>
    <a href="#ref-for-dom-rtcrtpsendparameters-degradationpreference-2" title="§ 5.3 Behavior of an RTCPeerConnection">§ 5.3 Behavior of an RTCPeerConnection</a> 
  </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-degradationpreference" aria-label="Links in this document to definition: degradationPreference">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-degradationpreference" aria-label="Permalink for definition: degradationPreference. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div>
<script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="www.w3.org/scripts/TR/2016/fixup.js"></script>
</body>
</html>