<!DOCTYPE html>
<html lang="en-us">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="generator" content="ReSpec 34.2.2">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-width:.2em;border-style:solid;background:#fbe9e9}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}</style>
<style>pre.idl{padding:1em;position:relative}
pre.idl>code{color:#000}
@media print{
pre.idl{white-space:pre-wrap}
}
.idlHeader{display:block;width:150px;background:#8ccbf2;color:#fff;font-family:sans-serif;font-weight:700;margin:-1em 0 1em -1em;height:28px;line-height:28px}
.idlHeader a.self-link{margin-left:.3cm;text-decoration:none;border-bottom:none}
.idlID{font-weight:700;color:#005a9c}
.idlType{color:#005a9c}
.idlName{color:#ff4500}
.idlName a{color:#ff4500;border-bottom:1px dotted #ff4500;text-decoration:none}
a.idlEnumItem{color:#000;border-bottom:1px dotted #ccc;text-decoration:none}
.idlSuperclass{font-style:italic;color:#005a9c}
.idlDefaultValue,.idlParamName{font-style:italic}
.extAttr{color:#666}
.idlSectionComment{color:gray}
.idlIncludes a{font-weight:700}
.respec-button-copy-paste:focus{text-decoration:none;border-color:#51a7e8;outline:0;box-shadow:0 0 5px rgba(81,167,232,.5)}
.respec-button-copy-paste:is(:focus:hover,.selected:focus){border-color:#51a7e8}
.respec-button-copy-paste:is(:hover,:active,.zeroclipboard-is-hover,.zeroclipboard-is-active){text-decoration:none;background-color:#ddd;background-image:linear-gradient(#eee,#ddd);border-color:#ccc}
.respec-button-copy-paste:is(:active,.selected,.zeroclipboard-is-active){background-color:#dcdcdc;background-image:none;border-color:#b5b5b5;box-shadow:inset 0 2px 4px rgba(0,0,0,.15)}
.respec-button-copy-paste.selected:hover{background-color:#cfcfcf}
.respec-button-copy-paste:is(:disabled,:disabled:hover,.disabled,.disabled:hover){color:rgba(102,102,102,.5);cursor:default;background-color:rgba(229,229,229,.5);background-image:none;border-color:rgba(197,197,197,.5);box-shadow:none}
@media print{
.respec-button-copy-paste{visibility:hidden}
}</style>
<style>dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}</style>
    
<link href="www.w3.org/TR/mediacapture-fromelement/fromelement.css" rel="stylesheet" type="text/css">
    
<title>Media Capture from DOM Elements</title>
    
    
<style id="respec-mainstyle">@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}</style>
    
  
<meta name="revision" content="081f0054684b3053c3e811e2dccad4855187bfc3">
<meta name="description" content="This document defines how a stream of media can be captured from a DOM element, such as a
        video, audio, or canvas
        element, in the form of a MediaStream [GETUSERMEDIA].">
<link rel="canonical" href="www.w3.org/TR/mediacapture-fromelement/">
<style>var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "WD",
  "shortName": "mediacapture-fromelement",
  "copyrightStart": "2015",
  "edDraftURI": "https://https://tawasl-zahra.github.io/whimsywondershttps://https://tawasl-zahra.github.io/whimsywonderstawasl-zahra.github.io/whimsywondersw3c.github.io/mediacapture-fromelement/",
  "editors": [
    {
      "name": "Martin Thomson",
      "company": "Mozilla",
      "w3cid": 68503
    },
    {
      "name": "Miguel Casas-Sanchez",
      "company": "Google, Inc.",
      "companyURL": "https://https://tawasl-zahra.github.io/whimsywondershttps://https://tawasl-zahra.github.io/whimsywonderstawasl-zahra.github.io/whimsywonderswww.google.com",
      "url": "mailto:mcasas@chromium.org?subject=MediaCapture%20fromElement%20W3C%20Spec",
      "w3cid": 82825,
      "note": "Media Element parts."
    },
    {
      "name": "Emircan Uysaler",
      "company": "Google, Inc.",
      "companyURL": "https://https://tawasl-zahra.github.io/whimsywondershttps://https://tawasl-zahra.github.io/whimsywonderstawasl-zahra.github.io/whimsywonderswww.google.com",
      "url": "mailto:emircan@chromium.org?subject=MediaCapture%20fromElement%20W3C%20Spec",
      "w3cid": 89334,
      "note": "Canvas Element parts."
    }
  ],
  "group": "webrtc",
  "wgPublicList": "public-webrtc",
  "testSuiteURI": "https://https://tawasl-zahra.github.io/whimsywondershttps://https://tawasl-zahra.github.io/whimsywonderstawasl-zahra.github.io/whimsywondersgithub.com/web-platform-tests/wpt/tree/master/mediacapture-fromelement",
  "github": "https://https://tawasl-zahra.github.io/whimsywondershttps://https://tawasl-zahra.github.io/whimsywonderstawasl-zahra.github.io/whimsywondersgithub.com/w3c/mediacapture-fromelement/",
  "xref": [
    "html",
    "webidl",
    "mediacapture-streams"
  ],
  "otherLinks": [
    {
      "key": "Participate",
      "data": [
        {
          "value": "Mailing list",
          "href": "https://https://tawasl-zahra.github.io/whimsywondershttps://https://tawasl-zahra.github.io/whimsywonderstawasl-zahra.github.io/whimsywonderslists.w3.org/Archives/Public/public-webrtc/"
        }
      ]
    }
  ],
  "gitRevision": "081f0054684b3053c3e811e2dccad4855187bfc3",
  "publishDate": "2023-12-12",
  "previousMaturity": "WD",
  "previousPublishDate": "2021-11-15",
  "publishISODate": "2023-12-12T00:00:00.000Z",
  "generatedSubtitle": "W3C Working Draft 12 December 2023"
}</script>
<link rel="stylesheet" href="www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>
  <body class="h-entry" data-cite="WEBIDL html webidl mediacapture-streams">
<div class="head">
    <p class="logos"><a class="logo" href="www.w3.org/"><img crossorigin="" alt="W3C" height="48" src="www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
  </a></p>
    <h1 id="title" class="title">Media Capture from DOM Elements</h1> 
    <p id="w3c-state"><a href="www.w3.org/standards/types#WD">W3C Working Draft</a> <time class="dt-published" datetime="2023-12-12">12 December 2023</time></p>
    <details open="">
      <summary>More details about this document</summary>
      <dl>
        <dt>This version:</dt>
<dd>
                <a class="u-url" href="www.w3.org/TR/2023/WD-mediacapture-fromelement-20231212/">https://www.w3.org/TR/2023/WD-mediacapture-fromelement-20231212/</a>
              </dd>
        <dt>Latest published version:</dt>
<dd>
                <a href="www.w3.org/TR/mediacapture-fromelement/">https://www.w3.org/TR/mediacapture-fromelement/</a>
              </dd>
        <dt>Latest editor's draft:</dt>
<dd><a href="w3c.github.io/mediacapture-fromelement/">https://w3c.github.io/mediacapture-fromelement/</a></dd>
        <dt>History:</dt>
<dd>
                    <a href="www.w3.org/standards/history/mediacapture-fromelement/">https://www.w3.org/standards/history/mediacapture-fromelement/</a>
                  </dd>
<dd>
                    <a href="github.com/w3c/mediacapture-fromelement/commits/">Commit history</a>
                  </dd>
        <dt>Test suite:</dt>
<dd><a href="github.com/web-platform-tests/wpt/tree/master/mediacapture-fromelement">https://github.com/web-platform-tests/wpt/tree/master/mediacapture-fromelement</a></dd>
        
        
        
        
        <dt>Editors:</dt>
<dd class="editor p-author h-card vcard" data-editor-id="68503">
    <span class="p-name fn">Martin Thomson</span> (<span class="p-org org h-org">Mozilla</span>)
  </dd>
<dd class="editor p-author h-card vcard" data-editor-id="82825">
    <a class="ed_mailto u-email email p-name" href="mailto:mcasas@chromium.org?subject=MediaCapture+fromElement+W3C+Spec">Miguel Casas-Sanchez</a> (<a class="p-org org h-org" href="www.google.com/">Google, Inc.</a>) (Media Element parts.)
  </dd>
<dd class="editor p-author h-card vcard" data-editor-id="89334">
    <a class="ed_mailto u-email email p-name" href="mailto:emircan@chromium.org?subject=MediaCapture+fromElement+W3C+Spec">Emircan Uysaler</a> (<a class="p-org org h-org" href="www.google.com/">Google, Inc.</a>) (Canvas Element parts.)
  </dd>
        
        
        <dt>Feedback:</dt>
<dd>
        <a href="github.com/w3c/mediacapture-fromelement/">GitHub w3c/mediacapture-fromelement</a>
        (<a href="github.com/w3c/mediacapture-fromelement/pulls/">pull requests</a>,
        <a href="github.com/w3c/mediacapture-fromelement/issues/new/choose">new issue</a>,
        <a href="github.com/w3c/mediacapture-fromelement/issues/">open issues</a>)
      </dd>
<dd>
<a href="mailto:public-webrtc@w3.org?subject=%5Bmediacapture-fromelement%5D+YOUR+TOPIC+HERE">public-webrtc@w3.org</a> with subject line <kbd>[mediacapture-fromelement] <em>… message topic …</em></kbd> (<a rel="discussion" href="lists.w3.org/Archives/Public/public-webrtc">archives</a>)</dd>
        
        <dt>Participate</dt>
<dd>
    <a href="lists.w3.org/Archives/Public/public-webrtc/">Mailing list</a>
  </dd>
      </dl>
    </details>
    
    
    <p class="copyright">
    <a href="www.w3.org/policies/#copyright">Copyright</a>
    ©
    2015-2023
    
    <a href="www.w3.org/">World Wide Web Consortium</a>.
    <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
    <a href="www.w3.org/policies/#Legal_Disclaimer">liability</a>,
    <a href="www.w3.org/policies/#W3C_Trademarks">trademark</a> and
    <a rel="license" href="www.w3.org/copyright/software-license-2023/" title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
  </p>
    <hr title="Separator for header">
  </div>
    <section id="abstract" class="introductory"><h2>Abstract</h2>
      <p>
        This document defines how a stream of media can be captured from a DOM element, such as a
        <code><a data-link-type="element" data-type="element" href="html.spec.whatwg.org/multipage/media.html#video">video</a></code>, <code><a data-link-type="element" data-type="element" href="html.spec.whatwg.org/multipage/media.html#audio">audio</a></code>, or <code><a data-link-type="element" data-type="element" href="html.spec.whatwg.org/multipage/canvas.html#canvas">canvas</a></code>
        element, in the form of a <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-getusermedia" title="Media Capture and Streams">GETUSERMEDIA</a></cite>].
      </p>
    </section>
    <section id="sotd" class="introductory"><h2>Status of This Document</h2>
<p><em>This section describes the status of this
      document at the time of its publication. A list of current <abbr title="World Wide Web Consortium">W3C</abbr>
      publications and the latest revision of this technical report can be found
      in the <a href="www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at
      https://www.w3.org/TR/.</em></p>
      <p>
        This document is not complete. It is subject to major changes and, while early
        experimentations are encouraged, it is therefore not intended for implementation.
      </p>
    <p>
    This document was published by the <a href="www.w3.org/groups/wg/webrtc">Web Real-Time Communications Working Group</a> as
    a Working Draft using the
        <a href="www.w3.org/2023/Process-20231103/#recs-and-notes">Recommendation track</a>. 
  </p>
<p>Publication as a Working Draft does not
  imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. </p>
<p>
    This is a draft document and may be updated, replaced or obsoleted by other
    documents at any time. It is inappropriate to cite this document as other
    than work in progress.
    
  </p>
<p>
    
        This document was produced by a group
        operating under the
        <a href="www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent
          Policy</a>.
      
    
                <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
                <a rel="disclosure" href="www.w3.org/groups/wg/webrtc/ipr">public list of any patent disclosures</a>
          made in connection with the deliverables of
          the group; that page also includes
          instructions for disclosing a patent. An individual who has actual
          knowledge of a patent which the individual believes contains
          <a href="www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a>
          must disclose the information in accordance with
          <a href="www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
        
  </p>
<p>
                      This document is governed by the
                      <a id="w3c_process_revision" href="www.w3.org/2023/Process-20231103/">03 November 2023 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                    </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2>
<ol class="toc">
<li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li>
<li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li>
<li class="tocline"><a class="tocxref" href="#intro"><bdi class="secno">1. </bdi>
        Introduction
      </a></li>
<li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">2. </bdi>Conformance</a></li>
<li class="tocline"><a class="tocxref" href="#html-media-element-media-capture-extensions"><bdi class="secno">3. </bdi>
        HTML Media Element Media Capture Extensions
      </a></li>
<li class="tocline">
<a class="tocxref" href="#html-canvas-element-media-capture-extensions"><bdi class="secno">4. </bdi>
        HTML Canvas Element Media Capture Extensions
      </a><ol class="toc"><li class="tocline"><a class="tocxref" href="#the-canvascapturemediastreamtrack"><bdi class="secno">4.1 </bdi>
          The <span data-xref-type="_IDL_" data-link-type="idl" data-lt="CanvasCaptureMediaStreamTrack" class="formerLink"><code>CanvasCaptureMediaStreamTrack</code></span>
        </a></li></ol>
</li>
<li class="tocline"><a class="tocxref" href="#security-considerations"><bdi class="secno">5. </bdi>
        Security Considerations
      </a></li>
<li class="tocline">
<a class="tocxref" href="#change-log"><bdi class="secno">6. </bdi>
        Change Log
      </a><ol class="toc"><li class="tocline"><a class="tocxref" href="#changes-since-2015-tbd-tbd"><bdi class="secno">6.1 </bdi>
        Changes since 2015-tbd-tbd
      </a></li></ol>
</li>
<li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">A. </bdi>
        Acknowledgements
      </a></li>
<li class="tocline">
<a class="tocxref" href="#references"><bdi class="secno">B. </bdi>References</a><ol class="toc">
<li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1 </bdi>Normative references</a></li>
<li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">B.2 </bdi>Informative references</a></li>
</ol>
</li>
</ol></nav>
    <section class="informative" id="intro"><div class="header-wrapper">
<h2 id="x1-introduction">
<bdi class="secno">1. </bdi>
        Introduction
      </h2>
<a class="self-link" href="#intro" aria-label="Permalink for Section 1."></a>
</div>
<p><em>This section is non-normative.</em></p>
      
      <p>
        This document describes an extension to both HTML media elements and the HTML canvas
        element that enables the capture of the output of the element in the form of streaming
        media.
      </p>
      <p>
        The captured media is formed into a <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-getusermedia" title="Media Capture and Streams">GETUSERMEDIA</a></cite>], which can
        then be consumed by the various APIs that process streams of media, such as WebRTC
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-webrtc" title="WebRTC: Real-Time Communication in Browsers">WEBRTC</a></cite>], or Web Audio [<cite><a class="bibref" data-link-type="biblio" href="#bib-webaudio" title="Web Audio API">WEBAUDIO</a></cite>].
      </p>
    </section>
    <section id="conformance"><div class="header-wrapper">
<h2 id="x2-conformance">
<bdi class="secno">2. </bdi>Conformance</h2>
<a class="self-link" href="#conformance" aria-label="Permalink for Section 2."></a>
</div>
<p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p>
<p>
        The key words <em class="rfc2119">MUST</em> and <em class="rfc2119">MUST NOT</em> in this document
        are to be interpreted as described in
        <a href="datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p>
      <p>
        This specification defines conformance criteria that apply to a single product: the
        <dfn id="dfn-user-agent" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">user agent</dfn> that implements the interfaces that it contains.
      </p>
      <p>
        Implementations that use ECMAScript to implement the APIs defined in this specification
        must implement them in a manner consistent with the ECMAScript Bindings defined in the Web
        IDL specification [<cite><a class="bibref" data-link-type="biblio" href="#bib-webidl" title="Web IDL Standard">WEBIDL</a></cite>], as this specification uses that specification and
        terminology.
      </p>
    </section>
    <section id="html-media-element-media-capture-extensions"><div class="header-wrapper">
<h2 id="x3-html-media-element-media-capture-extensions">
<bdi class="secno">3. </bdi>
        HTML Media Element Media Capture Extensions
      </h2>
<a class="self-link" href="#html-media-element-media-capture-extensions" aria-label="Permalink for Section 3."></a>
</div>
      
      <p>
        The method <a data-link-type="idl" href="#dom-htmlmediaelement-capturestream" class="internalDFN" id="ref-for-dom-htmlmediaelement-capturestream-1"><code>captureStream</code></a> is added on HTML [<cite><a class="bibref" data-link-type="biblio" href="#bib-html5" title="HTML5">HTML5</a></cite>] media elements.
        Methods for capture are added to both <a data-link-type="idl" data-lt="HTMLMediaElement" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#htmlmediaelement"><code>HTMLMediaElement</code></a>
        and <a data-link-type="idl" data-lt="HTMLCanvasElement" data-type="interface" href="html.spec.whatwg.org/multipage/canvas.html#htmlcanvaselement"><code>HTMLCanvasElement</code></a>.
      </p>
      <p>
        Both <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a> and <a data-link-type="idl" data-lt="HTMLMediaElement" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#htmlmediaelement"><code>HTMLMediaElement</code></a> expose the concept
        of a <q>track</q>. Since there is no common type used for
        <a data-link-type="idl" data-lt="HTMLMediaElement" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#htmlmediaelement"><code>HTMLMediaElement</code></a>, this document uses the term <dfn id="dfn-track" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">track</dfn> to refer
        to either <a data-link-type="idl" data-lt="VideoTrack" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#videotrack"><code>VideoTrack</code></a>
        or <a data-link-type="idl" data-lt="AudioTrack" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#audiotrack"><code>AudioTrack</code></a>.
        <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>
        is used to identify the media in a <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a>.
      </p>
      <div>
        <pre class="idl def" id="webidl-1161879082"><span class="idlHeader"><a class="self-link" href="#webidl-1161879082">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-htmlmediaelement-partial-1" data-title="HTMLMediaElement">partial interface <a data-idl="partial" data-link-type="interface" data-title="HTMLMediaElement" class="idlID" data-dfn-for="HTMLMediaElement" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#htmlmediaelement">HTMLMediaElement</a> {<span data-idl="" class="idlMethod" id="idl-def-htmlmediaelement-capturestream" data-title="captureStream" data-dfn-for="HTMLMediaElement"><span class="idlType">
    <a data-link-type="idl" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream">MediaStream</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-htmlmediaelement-capturestream" id="ref-for-dom-htmlmediaelement-capturestream-2"><code>captureStream</code></a> ();</span>
};</span></code></pre>
        <section>
          <div class="header-wrapper">
<h3 id="methods">
            Methods
          </h3>
<a class="self-link" href="#methods" aria-label="Permalink for this Section"></a>
</div>
          <dl class="methods">
            <dt>
              <a data-link-type="idl" href="#dom-htmlmediaelement-capturestream" class="internalDFN" id="ref-for-dom-htmlmediaelement-capturestream-3"><code>captureStream</code></a>
            </dt>
            <dd>
              <p>
                The <dfn data-dfn-for="HTMLMediaElement" data-export="" data-dfn-type="method" id="dom-htmlmediaelement-capturestream" data-idl="operation" data-title="captureStream()" data-type="MediaStream" data-lt="captureStream()" data-local-lt="HTMLMediaElement.captureStream|HTMLMediaElement.captureStream()|captureStream" tabindex="0" aria-haspopup="dialog"><code>captureStream()</code></dfn> method produces a real-time capture of
                the media that is rendered to the media element.
              </p>
              <p>
                The captured <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a> comprises of <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>s
                that render the content from the set of <a href="html.spec.whatwg.org/multipage/media.html#dom-videotracklist-selectedindex">
                selected</a> (for <a data-link-type="idl" data-lt="VideoTrack" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#videotrack"><code>VideoTrack</code></a>s, or other exclusively selected
                <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-1">track</a> types) or <a href="html.spec.whatwg.org/multipage/media.html#dom-audiotrack-enabled">enabled</a>
                (for <a data-link-type="idl" data-lt="AudioTrack" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#audiotrack"><code>AudioTrack</code></a>s, or other <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-2">track</a> types that support
                multiple selections) <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-3">track</a>s from the media element. If the media element
                does not have a selected or enabled <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-4">track</a>s of a given type, then no
                <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> of that type is present in the captured stream.
              </p>
              <p>
                A <code><a data-link-type="element" data-type="element" href="html.spec.whatwg.org/multipage/media.html#video">video</a></code> element can therefore capture a video
                <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> and any number of audio
                <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>s. An <code><a data-link-type="element" data-type="element" href="html.spec.whatwg.org/multipage/media.html#audio">audio</a></code> element can capture
                any number of audio <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>s. In both cases, the set of
                captured <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>s could be empty.
              </p>
              <p>
                Unless and until there is a <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-5">track</a> of given type that is selected or enabled,
                no <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> of that type is present in the captured stream. In
                particular, if the media element does not have a source assigned, then the captured
                <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a> has no tracks. Consequently, a media element with a ready
                state of <a href="html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing">HAVE_NOTHING</a>
                produces no captured <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> instances. Once metadata is
                available and the selected or enabled <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-6">track</a>s are determined, new captured
                <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> instances are created and added to the
                <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a>.
              </p>
              <p>
                A captured <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> <a href="w3c.github.io/mediacapture-main/#ends-nostop">ends</a> when <a href="html.spec.whatwg.org/multipage/media.html#ended-playback">playback
                ends</a> (and the <code>ended</code> event fires) or when the track that it
                captures is no longer selected or enabled for playback. A track is no longer
                selected or enabled if the source is changed by setting the <a data-link-type="idl" data-type="attribute" href="html.spec.whatwg.org/multipage/media.html#dom-media-src"><code>src</code></a> or
                <a data-link-type="idl" data-type="attribute" href="html.spec.whatwg.org/multipage/media.html#dom-media-srcobject"><code>srcObject</code></a> attributes of the media element.
              </p>
              <p>
                The set of captured <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>s change if the source of the
                media element changes. If the source for the media element ends, a different source
                is selected.
              </p>
              <p>
                If the selected <a data-link-type="idl" data-lt="VideoTrack" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#videotrack"><code>VideoTrack</code></a> or enabled <a data-link-type="idl" data-lt="AudioTrack" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#audiotrack"><code>AudioTrack</code></a>s for the media
                element change, a <code><a href="w3c.github.io/mediacapture-main/#event-mediastream-addtrack">addtrack</a></code>
                event with a new <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> is generated for each <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-7">track</a>
                that was not previously selected or enabled; and a <code><a href="w3c.github.io/mediacapture-main/#event-mediastream-removetrack">removetrack</a></code>
                events is generated for each <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-8">track</a> that ceases to be selected or enabled. A
                <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> <em class="rfc2119">MUST</em> end prior to being removed from the
                <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a>.
              </p>
              <p>
                Since a <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> can only end once, a track that is enabled,
                disabled and re-enabled will be captured as two separate tracks. Similarly,
                restarting playback after playback ends causes a new set of captured
                <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> instances to be created. Seeking during playback
                without changing track selection does not generate events or cause a captured
                <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> to end.
              </p>
              <p>
                The <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>s that comprise the captured
                <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a> become muted or unmuted as the tracks they capture change
                state. At any time, a media element might not have active content available for
                capture on a given track for a variety of reasons:
              </p>
              <ul>
                <li>Media playback could be paused.
                </li>
                <li>A <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-9">track</a> might not have content for the current playback time if that
                time is either before the content of that track starts or after the content ends.
                </li>
                <li>A <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> that is acting as a source could be
                <dfn id="dfn-muted" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><a href="w3c.github.io/mediacapture-main/#track-muted">muted</a></dfn>
                or <dfn id="dfn-disabled" tabindex="0" aria-haspopup="dialog" class="respec-offending-element" title="Found definition for &quot;disabled&quot;, but nothing links to it. This is usually a spec bug!" data-dfn-type="dfn"><a href="w3c.github.io/mediacapture-main/#track-enabled">disabled</a></dfn>.
                </li>
                <li>The contents of the <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-10">track</a> might become inaccessible to the current
                origin due to cross-origin protections. For instance, content that is rendered from
                an HTTP URL can be subject to a redirect on a request for partial content, or the
                enabled or selected tracks can change to include cross-origin content.
                </li>
              </ul>
              <p>
                Absence of content is reflected in captured tracks through the <code><a href="w3c.github.io/mediacapture-main/#dom-mediastreamtrack-muted">muted</a></code>
                attribute. A captured <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> <em class="rfc2119">MUST</em> have a
                <code><a href="#dfn-muted" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-muted-1">muted</a></code> attribute set to <code>true</code> if its corresponding
                source <a href="#dfn-track" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-track-11">track</a> does not have available and accessible content. A
                <code><a href="w3c.github.io/mediacapture-main/#event-mediastreamtrack-mute">
                mute</a></code> event is raised on the <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> when content
                availability changes.
              </p>
              <p>
                What output a muted capture produces as a result will vary based on the type of
                media: a <a data-link-type="idl" data-lt="VideoTrack" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#videotrack"><code>VideoTrack</code></a> ceases to capture new frames when muted,
                causing the captured stream to show the last captured frame; a muted
                <a data-link-type="idl" data-lt="AudioTrack" data-type="interface" href="html.spec.whatwg.org/multipage/media.html#audiotrack"><code>AudioTrack</code></a> produces silence.
              </p>
              <p>
                Whether a media element is actively rendering content (e.g., to a screen or audio
                device) has no effect on the content of captured streams. Muting the audio on a
                media element does not cause the capture to produce silence, nor does hiding a
                media element cause captured video to stop. Similarly, the audio level or volume of
                the media element does not affect the volume of captured audio.
              </p>
              <p>
                Captured audio from an element with an <a href="html.spec.whatwg.org/multipage/media.html#dom-media-playbackrate">effective
                playback rate</a> other than 1.0 <em class="rfc2119">MUST</em> be time-stretched. An unplayable playback
                rate causes the captured audio track to become muted.
              </p>
            </dd>
          </dl>
        </section>
      </div>
    </section>
    <section id="html-canvas-element-media-capture-extensions"><div class="header-wrapper">
<h2 id="x4-html-canvas-element-media-capture-extensions">
<bdi class="secno">4. </bdi>
        HTML Canvas Element Media Capture Extensions
      </h2>
<a class="self-link" href="#html-canvas-element-media-capture-extensions" aria-label="Permalink for Section 4."></a>
</div>
      
      <p>
        The <a data-link-type="idl" href="#dom-htmlcanvaselement-capturestream" class="internalDFN" id="ref-for-dom-htmlcanvaselement-capturestream-1"><code>captureStream</code></a> method is added to the HTML [<cite><a class="bibref" data-link-type="biblio" href="#bib-html5" title="HTML5">HTML5</a></cite>] canvas
        element. The resulting <a data-link-type="idl" data-lt="CanvasCaptureMediaStreamTrack" href="#dom-canvascapturemediastreamtrack" class="internalDFN" id="ref-for-dom-canvascapturemediastreamtrack-1"><code>CanvasCaptureMediaStreamTrack</code></a> provides methods
        that allow for controlling when frames are sampled from the canvas.
      </p>
      <div>
        <pre class="idl def" id="webidl-2128643227"><span class="idlHeader"><a class="self-link" href="#webidl-2128643227">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-htmlcanvaselement-partial-1" data-title="HTMLCanvasElement">partial interface <a data-idl="partial" data-link-type="interface" data-title="HTMLCanvasElement" class="idlID" data-dfn-for="HTMLCanvasElement" data-type="interface" href="html.spec.whatwg.org/multipage/canvas.html#htmlcanvaselement">HTMLCanvasElement</a> {<span data-idl="" class="idlMethod" id="idl-def-htmlcanvaselement-capturestream-framerequestrate" data-title="captureStream" data-dfn-for="HTMLCanvasElement"><span class="idlType">
    <a data-link-type="idl" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream">MediaStream</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-htmlcanvaselement-capturestream" id="ref-for-dom-htmlcanvaselement-capturestream-2"><code>captureStream</code></a> (optional<span class="idlType"> <a data-link-type="idl" data-type="interface" href="webidl.spec.whatwg.org/#idl-double">double</a></span> <span class="idlParamName">frameRequestRate</span>);</span>
};</span></code></pre>
        <section>
          <div class="header-wrapper">
<h3 id="methods-0">
            Methods
          </h3>
<a class="self-link" href="#methods-0" aria-label="Permalink for this Section"></a>
</div>
          <dl class="methods">
            <dt>
              <a data-link-type="idl" href="#dom-htmlcanvaselement-capturestream" class="internalDFN" id="ref-for-dom-htmlcanvaselement-capturestream-3"><code>captureStream</code></a>
            </dt>
            <dd>
              <p>
                The <dfn data-dfn-for="HTMLCanvasElement" data-export="" data-dfn-type="method" id="dom-htmlcanvaselement-capturestream" data-idl="operation" data-title="captureStream()" data-type="MediaStream" data-lt="captureStream()|captureStream(frameRequestRate)" data-local-lt="HTMLCanvasElement.captureStream|HTMLCanvasElement.captureStream()|captureStream" tabindex="0" aria-haspopup="dialog"><code>captureStream()</code></dfn> method produces a real-time video
                capture of the surface of the canvas. The resulting media stream has a single video
                <a data-link-type="idl" data-lt="CanvasCaptureMediaStreamTrack" href="#dom-canvascapturemediastreamtrack" class="internalDFN" id="ref-for-dom-canvascapturemediastreamtrack-2"><code>CanvasCaptureMediaStreamTrack</code></a> that matches the dimensions of
                the canvas element.
              </p>
              <p>
                Content from a canvas that is not <dfn id="dfn-origin-clean" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><a href="html.spec.whatwg.org/multipage/canvas.html#concept-canvas-origin-clean">
                origin-clean</a></dfn> <em class="rfc2119">MUST NOT</em> be captured. This method throws a <a data-link-type="idl" data-lt="SecurityError" data-type="exception" href="webidl.spec.whatwg.org/#securityerror"><code>SecurityError</code></a>
                exception if the canvas is not <a href="#dfn-origin-clean" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-origin-clean-1">origin-clean</a>.
              </p>
              <p>
                A captured stream <em class="rfc2119">MUST</em> immediately cease to capture content if the
                <a data-link-type="dfn|abstract-op" href="#dfn-origin-clean" class="internalDFN" id="ref-for-dfn-origin-clean-2">origin-clean</a> flag of the source canvas becomes false after the stream is
                created by <a data-link-type="idl" data-lt="captureStream()" href="#dom-htmlcanvaselement-capturestream" class="internalDFN" id="ref-for-dom-htmlcanvaselement-capturestream-4"><code>captureStream</code></a><code>()</code>. The captured <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>
                <em class="rfc2119">MUST</em> become <a href="#dfn-muted" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-muted-2">muted</a>, producing no new content while the canvas remains in this
                state.
              </p>
              <p>
                Each track that captures a canvas has a
                <dfn data-dfn-for="track" data-idl="" data-noexport="" data-dfn-type="attribute" id="dfn-framecapturerequested" tabindex="0" aria-haspopup="dialog"><code>[[frameCaptureRequested]]</code></dfn> internal slot that is set to <code>true</code> when a
                new frame is requested from the canvas.
              </p>
              <p>
                The value of  <a data-link-type="attribute" data-lt="[[frameCaptureRequested]]" href="#dfn-framecapturerequested" class="internalDFN" id="ref-for-dfn-framecapturerequested-1"><code>[[frameCaptureRequested]]</code></a> on all new
                tracks is set to <code>true</code> when the track is created. On creation of the
                captured track with a specific, non-zero <var>frameRequestRate</var>, the <a href="#dfn-user-agent" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-user-agent-1">user
                agent</a> starts a periodic timer at an interval of <code>1/<var>frameRequestRate</var></code>
                seconds. At each activation of the timer,
                <a data-link-type="attribute" data-lt="[[frameCaptureRequested]]" href="#dfn-framecapturerequested" class="internalDFN" id="ref-for-dfn-framecapturerequested-2"><code>[[frameCaptureRequested]]</code></a> is set to <code>true</code>.
              </p>
              <p>
                In order to support manual control of frame capture with the
                <a data-link-type="idl" href="#dom-canvascapturemediastreamtrack-requestframe" class="internalDFN" id="ref-for-dom-canvascapturemediastreamtrack-requestframe-1"><code>requestFrame</code></a>() method, browsers <em class="rfc2119">MUST</em> support a value of 0 for
                <var>frameRequestRate</var>. However, a captured stream <em class="rfc2119">MUST</em> request capture of a
                frame when created, even if <var>frameRequestRate</var> is zero.
              </p>
              <p>
                This method throws a <a data-link-type="idl" data-lt="NotSupportedError" data-type="exception" href="webidl.spec.whatwg.org/#notsupportederror"><code>NotSupportedError</code></a> if <var>frameRequestRate</var> is negative.
              </p>
              <p>
                A new frame is requested from the canvas when
                <a data-link-type="attribute" data-lt="[[frameCaptureRequested]]" href="#dfn-framecapturerequested" class="internalDFN" id="ref-for-dfn-framecapturerequested-3"><code>[[frameCaptureRequested]]</code></a> is true and the canvas is painted. Each
                time that the captured canvas is painted, the following steps are executed:
              </p>
              <ol>
                <li>For each <var>track</var> capturing from the canvas execute the following
                steps:
                  <ol>
                    <li>If new content has been drawn to the canvas since it was last painted, and
                    if the <a data-link-type="attribute" data-lt="[[frameCaptureRequested]]" href="#dfn-framecapturerequested" class="internalDFN" id="ref-for-dfn-framecapturerequested-4"><code>[[frameCaptureRequested]]</code></a> internal slot of
                    <var>track</var> is set, add a new frame to <var>track</var> containing what
                    was painted to the canvas.
                    </li>
                    <li>If a <var>frameRequestRate</var> value was specified, set the
                    <a data-link-type="attribute" data-lt="[[frameCaptureRequested]]" href="#dfn-framecapturerequested" class="internalDFN" id="ref-for-dfn-framecapturerequested-5"><code>[[frameCaptureRequested]]</code></a> internal slot of <var>track</var>
                    to <code>false</code>.
                    </li>
                  </ol>
                </li>
              </ol>
              <p>
                When adding new frames to <var>track</var> containing what was painted to the
                canvas, the alpha channel content of the canvas must be captured and preserved if
                the canvas is not fully opaque. The consumers of this <var>track</var> might not
                preserve the alpha channel.
              </p>
              <div class="note" role="note" id="issue-container-generatedID">
<div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>Note</span></div>
<p class="">
                This algorithm results in a captured track not starting until something changes in
                the canvas.
              </p>
</div>
              <table class="parameters">
                <tbody>
                  <tr>
                    <th>
                      Parameter
                    </th>
                    <th>
                      Type
                    </th>
                    <th>
                      Nullable
                    </th>
                    <th>
                      Optional
                    </th>
                    <th>
                      Description
                    </th>
                  </tr>
                  <tr>
                    <td class="prmName">
                      frameRequestRate
                    </td>
                    <td class="prmType">
                      <code>double</code>
                    </td>
                    <td class="prmNullFalse">
                      <span role="img" aria-label="False">✘</span>
                    </td>
                    <td class="prmOptTrue">
                      <span role="img" aria-label="True">✔</span>
                    </td>
                    <td class="prmDesc"></td>
                  </tr>
                </tbody>
              </table>
              <div>
                <em>Return type:</em> <a data-link-type="idl" data-lt="MediaStream" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastream"><code>MediaStream</code></a>
              </div>
            </dd>
          </dl>
        </section>
      </div>
      <section id="the-canvascapturemediastreamtrack"><div class="header-wrapper">
<h3 id="x4-1-the-canvascapturemediastreamtrack">
<bdi class="secno">4.1 </bdi>
          The <a data-link-type="idl" data-lt="CanvasCaptureMediaStreamTrack" href="#dom-canvascapturemediastreamtrack" class="internalDFN" id="ref-for-dom-canvascapturemediastreamtrack-3"><code>CanvasCaptureMediaStreamTrack</code></a>
        </h3>
<a class="self-link" href="#the-canvascapturemediastreamtrack" aria-label="Permalink for Section 4.1"></a>
</div>
        
        <p>
          The <dfn data-export="" data-dfn-type="interface" id="dom-canvascapturemediastreamtrack" data-idl="interface" data-title="CanvasCaptureMediaStreamTrack" data-dfn-for="" tabindex="0" aria-haspopup="dialog"><code>CanvasCaptureMediaStreamTrack</code></dfn> is an extension of
          <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a> that provide a single <a data-link-type="idl" data-lt="requestFrame()" href="#dom-canvascapturemediastreamtrack-requestframe" class="internalDFN" id="ref-for-dom-canvascapturemediastreamtrack-requestframe-2"><code>requestFrame</code></a><code>()</code> method.
          Applications that depend on tight control over the rendering of content to the media
          stream can use this method to control when frames from the canvas are captured.
        </p>
        <div>
          <pre class="idl def" id="webidl-378755061"><span class="idlHeader"><a class="self-link" href="#webidl-378755061">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-canvascapturemediastreamtrack" data-title="CanvasCaptureMediaStreamTrack">[<span class="extAttr"><a data-type="extended-attribute" href="webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>] interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-canvascapturemediastreamtrack" id="ref-for-dom-canvascapturemediastreamtrack-4"><code>CanvasCaptureMediaStreamTrack</code></a> : <span class="idlSuperclass"><a data-link-type="idl" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack">MediaStreamTrack</a></span> {<span data-idl="" class="idlAttribute" id="idl-def-canvascapturemediastreamtrack-canvas" data-title="canvas" data-dfn-for="CanvasCaptureMediaStreamTrack">
    readonly        attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="html.spec.whatwg.org/multipage/canvas.html#htmlcanvaselement">HTMLCanvasElement</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-canvascapturemediastreamtrack-canvas" id="ref-for-dom-canvascapturemediastreamtrack-canvas-1"><code>canvas</code></a>;</span><span data-idl="" class="idlMethod" id="idl-def-canvascapturemediastreamtrack-requestframe" data-title="requestFrame" data-dfn-for="CanvasCaptureMediaStreamTrack"><span class="idlType">
    <a data-link-type="idl" data-type="interface" href="webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-canvascapturemediastreamtrack-requestframe" id="ref-for-dom-canvascapturemediastreamtrack-requestframe-3"><code>requestFrame</code></a> ();</span>
};</span></code></pre>
          <section>
            <div class="header-wrapper">
<h4 id="attributes">
              Attributes
            </h4>
<a class="self-link" href="#attributes" aria-label="Permalink for this Section"></a>
</div>
            <dl data-link-for="CanvasCaptureMediaStreamTrack" data-dfn-for="CanvasCaptureMediaStreamTrack" class="attributes">
              <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-canvascapturemediastreamtrack-canvas" data-idl="attribute" data-title="canvas" data-dfn-for="CanvasCaptureMediaStreamTrack" data-type="HTMLCanvasElement" data-lt="canvas" data-local-lt="CanvasCaptureMediaStreamTrack.canvas" tabindex="0" aria-haspopup="dialog"><code>canvas</code></dfn> of type <a data-link-type="idl" data-lt="HTMLCanvasElement" data-type="interface" href="html.spec.whatwg.org/multipage/canvas.html#htmlcanvaselement"><code>HTMLCanvasElement</code></a>, readonly
              </dt>
              <dd>
                The canvas element that this media stream captures.
              </dd>
            </dl>
          </section>
          <section>
            <div class="header-wrapper">
<h4 id="methods-1">
              Methods
            </h4>
<a class="self-link" href="#methods-1" aria-label="Permalink for this Section"></a>
</div>
            <dl data-link-for="CanvasCaptureMediaStreamTrack" data-dfn-for="CanvasCaptureMediaStreamTrack" class="methods">
              <dt>
                <a data-link-type="idl" data-lt="requestFrame" href="#dom-canvascapturemediastreamtrack-requestframe" class="internalDFN" id="ref-for-dom-canvascapturemediastreamtrack-requestframe-4"><code>requestFrame</code></a>
              </dt>
              <dd>
                <p>
                  The <dfn data-export="" data-dfn-type="method" id="dom-canvascapturemediastreamtrack-requestframe" data-idl="operation" data-title="requestFrame" data-dfn-for="CanvasCaptureMediaStreamTrack" data-type="undefined" data-lt="requestFrame()" data-local-lt="CanvasCaptureMediaStreamTrack.requestFrame|CanvasCaptureMediaStreamTrack.requestFrame()|requestFrame" tabindex="0" aria-haspopup="dialog"><code>requestFrame</code></dfn>() method allows applications to manually
                  request that a frame from the canvas be captured and rendered into the track. In
                  cases where applications progressively render to a canvas, this allows
                  applications to avoid capturing a partially rendered frame.
                </p>
                <div class="note" role="note" id="issue-container-generatedID-0">
<div role="heading" class="note-title marker" id="h-note-0" aria-level="5"><span>Note</span></div>
<p class="">
                  As currently specified, this results in no <a data-link-type="idl" data-lt="SecurityError" data-type="exception" href="webidl.spec.whatwg.org/#securityerror"><code>SecurityError</code></a> or other
                  error feedback if the canvas is not origin-clean. In part, this is because we
                  don't track where requests for frames come from. Do we want to highlight that?
                </p>
</div>
                <div>
                  <em>No parameters.</em>
                </div>
                <div>
                  <em>Return type:</em> <code>undefined</code>
                </div>
              </dd>
            </dl>
          </section>
        </div>
      </section>
    </section>
    <section id="security-considerations"><div class="header-wrapper">
<h2 id="x5-security-considerations">
<bdi class="secno">5. </bdi>
        Security Considerations
      </h2>
<a class="self-link" href="#security-considerations" aria-label="Permalink for Section 5."></a>
</div>
      
      <p>
        Media elements can render media resources from origins that differ from the origin of the
        media element. In those cases, the contents of the resulting <a data-link-type="idl" data-lt="MediaStreamTrack" data-type="interface" href="www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack"><code>MediaStreamTrack</code></a>
        <em class="rfc2119">MUST</em> be protected from access by the document origin.
      </p>
      <p>
        How this protection manifests will differ, depending on how the content is accessed. For
        instance, rendering inaccessible video to a <code><a data-link-type="element" data-type="element" href="html.spec.whatwg.org/multipage/canvas.html#canvas">canvas</a></code> element [<cite><a class="bibref" data-link-type="biblio" href="#bib-html" title="HTML Standard">HTML</a></cite>]
        causes the <a data-link-type="dfn|abstract-op" href="#dfn-origin-clean" class="internalDFN" id="ref-for-dfn-origin-clean-3">origin-clean</a>
        flag of the canvas to become <code>false</code>; attempting to create a Web Audio
        <a data-link-type="idl" data-lt="MediaStreamAudioSourceNode" data-type="interface" href="www.w3.org/TR/webaudio/#MediaStreamAudioSourceNode"><code>MediaStreamAudioSourceNode</code></a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-webaudio" title="Web Audio API">WEBAUDIO</a></cite>] succeeds, but produces no information
        to the document origin (that is, only silence is transmitted into the audio context);
        attempting to transfer the media using WebRTC [<cite><a class="bibref" data-link-type="biblio" href="#bib-webrtc" title="WebRTC: Real-Time Communication in Browsers">WEBRTC</a></cite>] results in no information being
        transmitted.
      </p>
      <p>
        The origin of the media that is rendered by a media element can change at any time. This is
        even the case for a single media resource. User agents <em class="rfc2119">MUST</em> ensure that a change in the
        origin of media doesn't result in exposure of cross origin content.
      </p>
    </section>
    <section id="change-log"><div class="header-wrapper">
<h2 id="x6-change-log">
<bdi class="secno">6. </bdi>
        Change Log
      </h2>
<a class="self-link" href="#change-log" aria-label="Permalink for Section 6."></a>
</div>
      
      <p>
        This section will be removed before publication.
      </p>
      <section id="changes-since-2015-tbd-tbd"><div class="header-wrapper">
<h3 id="x6-1-changes-since-2015-tbd-tbd">
<bdi class="secno">6.1 </bdi>
        Changes since 2015-tbd-tbd
      </h3>
<a class="self-link" href="#changes-since-2015-tbd-tbd" aria-label="Permalink for Section 6.1"></a>
</div>
    </section></section>
    <section class="appendix" id="acknowledgements"><div class="header-wrapper">
<h2 id="a-acknowledgements">
<bdi class="secno">A. </bdi>
        Acknowledgements
      </h2>
<a class="self-link" href="#acknowledgements" aria-label="Permalink for Appendix A."></a>
</div>
      
      <p>
        This document is based on the stream processing specification [<cite><a class="bibref" data-link-type="biblio" href="#bib-streamproc" title="MediaStream Processing API">streamproc</a></cite>] originally
        developed by Robert O'Callahan.
      </p>
    </section>
  

<section id="references" class="appendix"><div class="header-wrapper">
<h2 id="b-references">
<bdi class="secno">B. </bdi>References</h2>
<a class="self-link" href="#references" aria-label="Permalink for Appendix B."></a>
</div>
<section id="normative-references"><div class="header-wrapper">
<h3 id="b-1-normative-references">
<bdi class="secno">B.1 </bdi>Normative references</h3>
<a class="self-link" href="#normative-references" aria-label="Permalink for Appendix B.1"></a>
</div>
    
    <dl class="bibliography">
<dt id="bib-html">[HTML]</dt>
<dd>
      <a href="html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van Kesteren; Domenic Denicola; Ian Hickson; Philip Jägenstedt; Simon Pieters.  WHATWG. Living Standard. URL: <a href="html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
    </dd>
<dt id="bib-html5">[HTML5]</dt>
<dd>
      <a href="www.w3.org/TR/html5/"><cite>HTML5</cite></a>. Ian Hickson; Robin Berjon; Steve Faulkner; Travis Leithead; Erika Doyle Navara; Theresa O'Connor; Silvia Pfeiffer.  W3C. 27 March 2018. W3C Recommendation. URL: <a href="www.w3.org/TR/html5/">https://www.w3.org/TR/html5/</a>
    </dd>
<dt id="bib-mediacapture-streams">[mediacapture-streams]</dt>
<dd>
      <a href="www.w3.org/TR/mediacapture-streams/"><cite>Media Capture and Streams</cite></a>. Cullen Jennings; Bernard Aboba; Jan-Ivar Bruaroey; Henrik Boström; youenn fablet.  W3C. 20 November 2023. W3C Candidate Recommendation. URL: <a href="www.w3.org/TR/mediacapture-streams/">https://www.w3.org/TR/mediacapture-streams/</a>
    </dd>
<dt id="bib-rfc2119">[RFC2119]</dt>
<dd>
      <a href="www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd>
<dt id="bib-rfc8174">[RFC8174]</dt>
<dd>
      <a href="www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
    </dd>
<dt id="bib-streamproc">[streamproc]</dt>
<dd>
      <a href="www.w3.org/TR/streamproc/"><cite>MediaStream Processing API</cite></a>. Robert O'Callahan.  W3C. 31 May 2012. W3C Working Group Note. URL: <a href="www.w3.org/TR/streamproc/">https://www.w3.org/TR/streamproc/</a>
    </dd>
<dt id="bib-webaudio">[WEBAUDIO]</dt>
<dd>
      <a href="www.w3.org/TR/webaudio/"><cite>Web Audio API</cite></a>. Paul Adenot; Hongchan Choi.  W3C. 17 June 2021. W3C Recommendation. URL: <a href="www.w3.org/TR/webaudio/">https://www.w3.org/TR/webaudio/</a>
    </dd>
<dt id="bib-webidl">[WEBIDL]</dt>
<dd>
      <a href="webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Edgar Chen; Timothy Gu.  WHATWG. Living Standard. URL: <a href="webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dd>
<dt id="bib-webrtc">[WEBRTC]</dt>
<dd>
      <a href="www.w3.org/TR/webrtc/"><cite>WebRTC: Real-Time Communication in Browsers</cite></a>. Cullen Jennings; Florent Castelli; Henrik Boström; Jan-Ivar Bruaroey.  W3C. 6 March 2023. W3C Recommendation. URL: <a href="www.w3.org/TR/webrtc/">https://www.w3.org/TR/webrtc/</a>
    </dd>
</dl>
  </section><section id="informative-references"><div class="header-wrapper">
<h3 id="b-2-informative-references">
<bdi class="secno">B.2 </bdi>Informative references</h3>
<a class="self-link" href="#informative-references" aria-label="Permalink for Appendix B.2"></a>
</div>
    
    <dl class="bibliography">
<dt id="bib-getusermedia">[GETUSERMEDIA]</dt>
<dd>
      <a href="www.w3.org/TR/mediacapture-streams/"><cite>Media Capture and Streams</cite></a>. Cullen Jennings; Bernard Aboba; Jan-Ivar Bruaroey; Henrik Boström; youenn fablet.  W3C. 20 November 2023. W3C Candidate Recommendation. URL: <a href="www.w3.org/TR/mediacapture-streams/">https://www.w3.org/TR/mediacapture-streams/</a>
    </dd>
</dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-user-agent" aria-label="Links in this document to definition: user agent">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-user-agent" aria-label="Permalink for definition: user agent. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-user-agent-1" title="§ Methods">§ Methods</a> 
    </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-track" aria-label="Links in this document to definition: track">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-track" aria-label="Permalink for definition: track. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-track-1" title="§ Methods">§ Methods</a> <a href="#ref-for-dfn-track-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-track-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-track-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-track-5" title="Reference 5">(5)</a> <a href="#ref-for-dfn-track-6" title="Reference 6">(6)</a> <a href="#ref-for-dfn-track-7" title="Reference 7">(7)</a> <a href="#ref-for-dfn-track-8" title="Reference 8">(8)</a> <a href="#ref-for-dfn-track-9" title="Reference 9">(9)</a> <a href="#ref-for-dfn-track-10" title="Reference 10">(10)</a> <a href="#ref-for-dfn-track-11" title="Reference 11">(11)</a> 
    </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-htmlmediaelement-capturestream" aria-label="Links in this document to definition: captureStream()">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-htmlmediaelement-capturestream" aria-label="Permalink for definition: captureStream(). Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-1161879082">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dom-htmlmediaelement-capturestream-1" title="§ 3. HTML Media Element Media Capture Extensions">§ 3. HTML Media Element Media Capture Extensions</a> <a href="#ref-for-dom-htmlmediaelement-capturestream-2" title="Reference 2">(2)</a> 
    </li>
<li>
      <a href="#ref-for-dom-htmlmediaelement-capturestream-3" title="§ Methods">§ Methods</a> 
    </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-muted" aria-label="Links in this document to definition: muted">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-muted" aria-label="Permalink for definition: muted. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-muted-1" title="§ Methods">§ Methods</a> <a href="#ref-for-dfn-muted-2" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-disabled" aria-label="Links in this document to definition: disabled">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-disabled" aria-label="Permalink for definition: disabled. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-htmlcanvaselement-capturestream" aria-label="Links in this document to definition: captureStream()">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-htmlcanvaselement-capturestream" aria-label="Permalink for definition: captureStream(). Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-2128643227">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dom-htmlcanvaselement-capturestream-1" title="§ 4. HTML Canvas Element Media Capture Extensions">§ 4. HTML Canvas Element Media Capture Extensions</a> <a href="#ref-for-dom-htmlcanvaselement-capturestream-2" title="Reference 2">(2)</a> 
    </li>
<li>
      <a href="#ref-for-dom-htmlcanvaselement-capturestream-3" title="§ Methods">§ Methods</a> <a href="#ref-for-dom-htmlcanvaselement-capturestream-4" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-origin-clean" aria-label="Links in this document to definition: origin-clean">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-origin-clean" aria-label="Permalink for definition: origin-clean. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-origin-clean-1" title="§ Methods">§ Methods</a> <a href="#ref-for-dfn-origin-clean-2" title="Reference 2">(2)</a> 
    </li>
<li>
      <a href="#ref-for-dfn-origin-clean-3" title="§ 5. Security Considerations">§ 5. Security Considerations</a> 
    </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-framecapturerequested" aria-label="Links in this document to definition: [[frameCaptureRequested]]">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-framecapturerequested" aria-label="Permalink for definition: [[frameCaptureRequested]]. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-framecapturerequested-1" title="§ Methods">§ Methods</a> <a href="#ref-for-dfn-framecapturerequested-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-framecapturerequested-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-framecapturerequested-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-framecapturerequested-5" title="Reference 5">(5)</a> 
    </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-canvascapturemediastreamtrack" aria-label="Links in this document to definition: CanvasCaptureMediaStreamTrack">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-canvascapturemediastreamtrack" aria-label="Permalink for definition: CanvasCaptureMediaStreamTrack. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-378755061">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dom-canvascapturemediastreamtrack-1" title="§ 4. HTML Canvas Element Media Capture Extensions">§ 4. HTML Canvas Element Media Capture Extensions</a> 
    </li>
<li>
      <a href="#ref-for-dom-canvascapturemediastreamtrack-2" title="§ Methods">§ Methods</a> 
    </li>
<li>
      <a href="#ref-for-dom-canvascapturemediastreamtrack-3" title="§ 4.1 The CanvasCaptureMediaStreamTrack">§ 4.1 The CanvasCaptureMediaStreamTrack</a> <a href="#ref-for-dom-canvascapturemediastreamtrack-4" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-canvascapturemediastreamtrack-canvas" aria-label="Links in this document to definition: canvas">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-canvascapturemediastreamtrack-canvas" aria-label="Permalink for definition: canvas. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-378755061">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dom-canvascapturemediastreamtrack-canvas-1" title="§ 4.1 The CanvasCaptureMediaStreamTrack">§ 4.1 The CanvasCaptureMediaStreamTrack</a> 
    </li>
  </ul>
    </div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-canvascapturemediastreamtrack-requestframe" aria-label="Links in this document to definition: requestFrame">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-canvascapturemediastreamtrack-requestframe" aria-label="Permalink for definition: requestFrame. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-378755061">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dom-canvascapturemediastreamtrack-requestframe-1" title="§ Methods">§ Methods</a> <a href="#ref-for-dom-canvascapturemediastreamtrack-requestframe-4" title="Reference 2">(2)</a> 
    </li>
<li>
      <a href="#ref-for-dom-canvascapturemediastreamtrack-requestframe-2" title="§ 4.1 The CanvasCaptureMediaStreamTrack">§ 4.1 The CanvasCaptureMediaStreamTrack</a> <a href="#ref-for-dom-canvascapturemediastreamtrack-requestframe-3" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div>
<script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="www.w3.org/scripts/TR/2021/fixup.js"></script>
</body>
</html>